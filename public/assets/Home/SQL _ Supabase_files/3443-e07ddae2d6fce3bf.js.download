!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="dc64edd6-f14f-4184-918a-b98fb6c99d17",e._sentryDebugIdIdentifier="sentry-dbid-dc64edd6-f14f-4184-918a-b98fb6c99d17")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3443],{6927:function(e,t,s){s.d(t,{T:function(){return d}});var n=s(36457),r=s(64618),a=s(34549),i=s(6464),l=s(26600);async function o(e){let{projectRef:t,userId:s}=e,{data:n,error:r}=await (0,i.IV)("/platform/auth/{ref}/users/{id}",{params:{path:{ref:t,id:s}}});return r&&(0,i.S3)(r),n}let d=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,n.NL)();return(0,r.D)(e=>o(e),{async onSuccess(t,s,n){let{projectRef:r,skipInvalidation:a=!1}=s;a||await Promise.all([i.invalidateQueries(l.o.usersInfinite(r)),i.invalidateQueries(l.o.usersCount(r))]),await (null==e?void 0:e(t,s,n))},async onError(e,s,n){void 0===t?a.Am.error("Failed to delete user: ".concat(e.message)):t(e,s,n)},...s})}},33372:function(e,t,s){s.d(t,{x7:function(){return d}});var n=s(90688),r=s(25878),a=s(62432),i=s(37756),l=s(26600);let o=e=>{let{page:t=0,verified:s,keywords:n,providers:r,sort:a,order:i}=e,l=[];if(n&&""!==n){let e=n.replaceAll("'","''");l.push("id::text like '%".concat(e,"%' or email like '%").concat(e,"%' or phone like '%").concat(e,"%'"))}"verified"===s?l.push("email_confirmed_at IS NOT NULL or phone_confirmed_at IS NOT NULL"):"anonymous"===s?l.push("is_anonymous is true"):"unverified"===s&&l.push("email_confirmed_at IS NULL AND phone_confirmed_at IS NULL"),r&&r.length>0&&(r.includes("saml 2.0")?l.push("(select jsonb_agg(case when value ~ '^sso' then 'sso' else value end) from jsonb_array_elements_text((raw_app_meta_data ->> 'providers')::jsonb)) ?| array[".concat(r.map(e=>"saml 2.0"===e?"'sso'":"'".concat(e,"'")).join(", "),"]").trim()):l.push("(raw_app_meta_data->>'providers')::jsonb ?| array[".concat(r.map(e=>"'".concat(e,"'")).join(", "),"]")));let o=l.map(e=>"(".concat(e,")")).join(" and ");return"".concat("\n  select *, coalesce((select array_agg(distinct i.provider) from auth.identities i where i.user_id = auth.users.id), '{}'::text[]) as providers from auth.users\n  ".trim()).concat(l.length>0?" where ".concat(o):"",' order by "').concat(null!=a?a:"created_at",'" ').concat(null!=i?i:"desc"," nulls last limit ").concat(50," offset ").concat(50*t,";")},d=function(e){let{projectRef:t,connectionString:s,keywords:d,filter:c,providers:u,sort:m,order:x}=e,{enabled:h=!0,...f}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=(0,a.Vm)(),v=(null==p?void 0:p.status)===i.S.ACTIVE_HEALTHY;return(0,n.N)(l.o.usersInfinite(t,{keywords:d,filter:c,providers:u,sort:m,order:x}),e=>{let{signal:n,pageParam:a}=e;return(0,r.R)({projectRef:t,connectionString:s,sql:o({page:a,verified:c,keywords:d,providers:u,sort:null!=m?m:"created_at",order:null!=x?x:"desc"}),queryKey:l.o.usersInfinite(t)},n)},{enabled:h&&void 0!==t&&v,getNextPageParam(e,t){let s=t.length;if(e.result.length>=50)return s},...f})}},96770:function(e,t,s){s.d(t,{Z:function(){return a}});var n=s(90876),r=s(52983);let a=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.useMemo)(()=>{var e;let[s,r]=t;if(!(null===(e=s[0])||void 0===e?void 0:e[r]))return{data:s,error:void 0,isError:!1};try{return{data:(0,n.h6)(...t).sort((e,s)=>new Date(e[t[1]])-new Date(s[t[1]])),error:void 0,isError:!1}}catch(e){return{data:[],error:e,isError:!0}}},[JSON.stringify(t[0]),...t])}},25024:function(e,t,s){s.d(t,{k:function(){return l}});var n=s(62213);let r={search:"",timestampStart:"",timestampEnd:"",filters:{}},a=e=>(0,n.jo)({parse:t=>null!=t?t:e,serialize:e=>e||""}),i=e=>(0,n.jo)({parse:t=>{if(!t)return e;try{return JSON.parse(t)}catch(t){return e}},serialize:e=>{if(!e)return"";try{return JSON.stringify(e)}catch(e){return""}}});function l(){let[e,t]=(0,n.v1)("s",a(r.search)),[s,l]=(0,n.v1)("its",a(r.timestampStart)),[o,d]=(0,n.v1)("ite",a(r.timestampEnd)),[c,u]=(0,n.v1)("log",a("")),[m,x]=(0,n.v1)("f",i(r.filters)),h=e||r.search,f=s||r.timestampStart,p=o||r.timestampEnd,v=m||r.filters,g=e=>{t(e||r.search)},y=e=>{x(e||r.filters)};return{search:h,timestampStart:f,timestampEnd:p,selectedLogId:c||null,filters:v,setSearch:g,setTimeRange:(e,t)=>{l(e||r.timestampStart),d(t||r.timestampEnd)},setSelectedLogId:e=>{u(e||"")},setFilters:y,updateFilter:(e,t)=>{y({...v,[e]:t})},reset:()=>{g(r.search),l(r.timestampStart),d(r.timestampEnd),u(""),x(r.filters)}}}},39988:function(e,t,s){s.d(t,{T:function(){return d}});var n=s(97458),r=s(12436),a=s(34549),i=s(6927),l=s(45536),o=s(32002);let d=e=>{var t,s;let{visible:d,selectedUser:c,onClose:u,onDeleteSuccess:m}=e,{ref:x}=(0,r.UO)(),{mutate:h,isLoading:f}=(0,i.T)({onSuccess:()=>{a.Am.success("Successfully deleted ".concat(null==c?void 0:c.email)),null==m||m()}}),p=async()=>(await (0,l.Vs)(200),x)?(null==c?void 0:c.id)===void 0?a.Am.error("Failed to delete user: User ID not found"):void h({projectRef:x,userId:c.id}):console.error("Project ref is required");return(0,n.jsx)(o.Z,{visible:d,variant:"destructive",title:"Confirm to delete user",loading:f,confirmLabel:"Delete",onCancel:()=>u(),onConfirm:()=>p(),alert:{title:"Deleting a user is irreversible",description:"This will remove the selected the user from the project and all associated data."},"data-sentry-element":"ConfirmationModal","data-sentry-component":"DeleteUserModal","data-sentry-source-file":"DeleteUserModal.tsx",children:(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:["This is permanent! Are you sure you want to delete the user"," ",null!==(s=null!==(t=null==c?void 0:c.email)&&void 0!==t?t:null==c?void 0:c.phone)&&void 0!==s?s:"this user","?"]})})}},5430:function(e,t,s){s.d(t,{w:function(){return d}});var n=s(97458),r=s(58596),a=s(66318),i=s(65092),l=s(70107),o=s(40662);let d=e=>{var t,s,d;let{user:c}=e,u=(0,o.Gf)(c),m="-"!==u,x=null!==c.phone,h=c.is_anonymous;return(0,n.jsx)("div",{className:(0,i.cn)(l.l),"data-sentry-component":"UserHeader","data-sentry-source-file":"UserHeader.tsx",children:x?(0,n.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,n.jsx)("p",{children:c.phone}),(0,n.jsx)(a.Z,{iconOnly:!0,type:"text",icon:(0,n.jsx)(r.Z,{}),className:"px-1",text:null!==(t=null==c?void 0:c.phone)&&void 0!==t?t:""})]}):h?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{children:"Anonymous user"}),(0,n.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,n.jsx)("p",{className:"text-foreground-light text-sm",children:c.id}),(0,n.jsx)(a.Z,{iconOnly:!0,type:"text",icon:(0,n.jsx)(r.Z,{}),className:"px-1",text:null!==(s=null==c?void 0:c.id)&&void 0!==s?s:""})]})]}):(0,n.jsxs)(n.Fragment,{children:[m&&(0,n.jsx)("p",{children:u}),(0,n.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,n.jsx)("p",{className:(0,i.cn)(m?"text-foreground-light text-sm":"text-foreground"),children:c.email}),(0,n.jsx)(a.Z,{iconOnly:!0,type:"text",icon:(0,n.jsx)(r.Z,{}),className:"px-1",text:null!==(d=null==c?void 0:c.email)&&void 0!==d?d:""})]})]})})}},23618:function(e,t,s){s.d(t,{KU:function(){return eo},ah:function(){return el},wC:function(){return ei}});var n=s(97458),r=s(198),a=s(28977),i=s.n(a),l=s(62507),o=s(49475),d=s(33319),c=s(99847),u=s(74304),m=s(98686),x=s(58596),h=s(83145),f=s.n(h),p=s(52983),v=s(34549),g=s(12436),y=s(359),j=s(66318),w=s(72909),b=s(64618),_=s(6464);async function N(e){let{projectRef:t,userId:s}=e,{data:n,error:r}=await (0,_.IV)("/platform/auth/{ref}/users/{id}/factors",{params:{path:{ref:t,id:s}}});return r&&(0,_.S3)(r),n}let S=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,b.D)(e=>N(e),{async onSuccess(t,s,n){await (null==e?void 0:e(t,s,n))},async onError(e,s,n){void 0===t?v.Am.error("Failed to delete the user's MFA factors: ".concat(e.message)):t(e,s,n)},...s})};async function C(e){let{projectRef:t,user:s}=e,{data:n,error:r}=await (0,_.v_)("/platform/auth/{ref}/recover",{params:{path:{ref:t}},body:{email:s.email}});return r&&(0,_.S3)(r),n}let U=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,b.D)(e=>C(e),{async onSuccess(t,s,n){await (null==e?void 0:e(t,s,n))},async onError(e,s,n){void 0===t?v.Am.error("Failed to reset user password: ".concat(e.message)):t(e,s,n)},...s})};async function k(e){let{projectRef:t,user:s}=e,{data:n,error:r}=await (0,_.v_)("/platform/auth/{ref}/magiclink",{params:{path:{ref:t}},body:{email:s.email}});return r&&(0,_.S3)(r),n}let A=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,b.D)(e=>k(e),{async onSuccess(t,s,n){await (null==e?void 0:e(t,s,n))},async onError(e,s,n){void 0===t?v.Am.error("Failed to send magic link: ".concat(e.message)):t(e,s,n)},...s})};async function D(e){let{projectRef:t,user:s}=e,{data:n,error:r}=await (0,_.v_)("/platform/auth/{ref}/otp",{params:{path:{ref:t}},body:{phone:s.phone}});return r&&(0,_.S3)(r),n}let T=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,b.D)(e=>D(e),{async onSuccess(t,s,n){await (null==e?void 0:e(t,s,n))},async onError(e,s,n){void 0===t?v.Am.error("Failed to send magic link: ".concat(e.message)):t(e,s,n)},...s})};var L=s(36457),O=s(26600);async function z(e){let{projectRef:t,userId:s,banDuration:n}=e,{data:r,error:a}=await (0,_.r$)("/platform/auth/{ref}/users/{id}",{params:{path:{ref:t,id:s}},body:{ban_duration:"number"==typeof n?"".concat(n,"h"):n}});return a&&(0,_.S3)(a),r}let P=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,L.NL)();return(0,b.D)(e=>z(e),{async onSuccess(t,s,r){let{projectRef:a}=s;await n.invalidateQueries(O.o.usersInfinite(a)),await (null==e?void 0:e(t,s,r))},async onError(e,s,n){void 0===t?v.Am.error("Failed to update user: ".concat(e.message)):t(e,s,n)},...s})};var Z=s(90817),E=s(37756),M=s(45536),I=s(65092),F=s(11221),R=s(90839),B=s(33526),W=s(32002),H=s(94102),q=s(78751),X=s(86848),V=s(5394),K=s(42155),G=s(49142),Q=s(56740),Y=s(22714),J=s(78366);let $=e=>{let{visible:t,user:s,onClose:r}=e,{ref:a}=(0,g.UO)(),{mutate:l,isLoading:o}=P({onSuccess:(e,t)=>{let s=i()().add(Number(t.banDuration),"hours").format("DD MMM YYYY HH:mm (ZZ)");v.Am.success("User banned successfully until ".concat(s)),r()}}),d=V.Ry({value:V.Z_().min(1,{message:"Please provide a duration"}),unit:V.Km(["hours","days"])}),c={value:"24",unit:"hours"},u=(0,X.cI)({mode:"onBlur",reValidateMode:"onChange",resolver:(0,q.F)(d),defaultValues:c}),{value:m,unit:x}=u.watch(),h=i()().add(Number(m),x).format("DD MMM YYYY HH:mm (ZZ)");return(0,p.useEffect)(()=>{t&&u.reset(c)},[t]),(0,n.jsx)(K.Z,{hideFooter:!0,visible:t,size:"small",header:"Confirm to ban user",onCancel:()=>r(),"data-sentry-element":"Modal","data-sentry-component":"BanUserModal","data-sentry-source-file":"BanUserModal.tsx",children:(0,n.jsx)(G.l0,{...u,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"BanUserModal.tsx",children:(0,n.jsxs)("form",{onSubmit:u.handleSubmit(e=>{if(void 0===a)return console.error("Project ref is required");if(void 0===s.id)return v.Am.error("Failed to ban user: User ID not found");let t="hours"===e.unit?Number(e.value):24*Number(e.value);l({projectRef:a,userId:s.id,banDuration:t})}),children:[(0,n.jsxs)(K.Z.Content,{className:"flex flex-col gap-y-3","data-sentry-element":"unknown","data-sentry-source-file":"BanUserModal.tsx",children:[(0,n.jsx)("p",{className:"text-sm",children:"This will revoke the user's access to your project and prevent them from logging in for a specified duration."}),(0,n.jsxs)("div",{className:"flex items-start gap-x-2 [&>div:first-child]:flex-grow",children:[(0,n.jsx)(G.Wi,{control:u.control,name:"value",render:e=>{let{field:t}=e;return(0,n.jsx)(J.E,{className:"[&>div>div]:mt-0",label:"Set a ban duration",children:(0,n.jsx)(G.NI,{children:(0,n.jsx)(Q.I,{...t})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"BanUserModal.tsx"}),(0,n.jsx)(G.Wi,{control:u.control,name:"unit",render:e=>{let{field:t}=e;return(0,n.jsx)(J.E,{className:"[&>div>div]:mt-0 mt-[33px]",children:(0,n.jsx)(G.NI,{children:(0,n.jsxs)(Y.Ph,{...t,value:t.value,onValueChange:e=>u.setValue("unit",e),children:[(0,n.jsx)(Y.i4,{className:"capitalize w-24",children:t.value}),(0,n.jsxs)(Y.Bw,{children:[(0,n.jsx)(Y.Ql,{value:"hours",children:"Hours"}),(0,n.jsx)(Y.Ql,{value:"days",children:"Days"})]})]})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"BanUserModal.tsx"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-foreground-lighter",children:"This user will not be able to log in until:"}),(0,n.jsx)("p",{className:(0,I.cn)("text-sm",!m&&"text-foreground-light"),children:m?h:"Invalid duration set"})]})]}),(0,n.jsx)(F.Z,{"data-sentry-element":"Separator","data-sentry-source-file":"BanUserModal.tsx"}),(0,n.jsxs)(K.Z.Content,{className:"flex justify-end gap-2","data-sentry-element":"unknown","data-sentry-source-file":"BanUserModal.tsx",children:[(0,n.jsx)(R.z,{type:"default",disabled:o,onClick:()=>r(),"data-sentry-element":"Button","data-sentry-source-file":"BanUserModal.tsx",children:"Cancel"}),(0,n.jsx)(R.z,{type:"warning",htmlType:"submit",loading:o,"data-sentry-element":"Button","data-sentry-source-file":"BanUserModal.tsx",children:"Confirm ban"})]})]})})})};var ee=s(39988),et=s(5430),es=s(70107),en=s(40662);let er="DD MMM, YYYY HH:mm",ea=(0,I.cn)("bg-surface-100 border-default text-foreground flex items-center justify-between","gap-x-4 border px-5 py-4 text-sm first:rounded-tr first:rounded-tl last:rounded-br last:rounded-bl"),ei=e=>{var t,s,a,m,x;let{user:h,onDeleteSuccess:y}=e,{ref:j}=(0,g.UO)(),b=null!==h.email,_=null!==h.phone,N=null!==h.banned_until,C=(null!==(s=null===(t=h.raw_app_meta_data)||void 0===t?void 0:t.providers)&&void 0!==s?s:[]).map(e=>({name:e.startsWith("sso")?"SAML":e,icon:"email"===e?"".concat(E.GW,"/img/icons/email-icon2.svg"):en.Bn[e]?"".concat(E.GW,"/img/icons/").concat(en.Bn[e],".svg"):void 0})),k=(0,Z.Xo)(r.KA.AUTH_EXECUTE,"*"),D=(0,Z.Xo)(r.KA.AUTH_EXECUTE,"send_magic_link"),L=(0,Z.Xo)(r.KA.AUTH_EXECUTE,"send_recovery"),O=(0,Z.Xo)(r.KA.AUTH_EXECUTE,"send_otp"),z=(0,Z.Xo)(r.KA.TENANT_SQL_DELETE,"auth.users"),q=(0,Z.Xo)(r.KA.TENANT_SQL_DELETE,"auth.mfa_factors"),[X,V]=(0,p.useState)(),[K,G]=(0,p.useState)(!1),[Q,Y]=(0,p.useState)(!1),[J,ei]=(0,p.useState)(!1),[ed,ec]=(0,p.useState)(!1),{data:eu}=(0,w.$E)({projectRef:j}),em=null!==(a=null==eu?void 0:eu.MAILER_OTP_EXP)&&void 0!==a?a:0,ex=Math.floor(em/60),eh=Math.floor(em%60),ef="".concat(em>60?"".concat(ex," minute").concat(ex>1?"s":""," ").concat(eh>0?"and":""," "):"").concat(eh>0?"".concat(eh," second").concat(eh>1?"s":""):""),{mutate:ep,isLoading:ev}=U({onSuccess:(e,t)=>{V("send_recovery"),v.Am.success("Sent password recovery to ".concat(t.user.email))},onError:e=>{v.Am.error("Failed to send password recovery: ".concat(e.message))}}),{mutate:eg,isLoading:ey}=A({onSuccess:(e,t)=>{V("send_magic_link"),v.Am.success("Sent magic link to ".concat(t.user.email))},onError:e=>{v.Am.error("Failed to send magic link: ".concat(e.message))}}),{mutate:ej,isLoading:ew}=T({onSuccess:(e,t)=>{V("send_otp"),v.Am.success("Sent OTP to ".concat(t.user.phone))},onError:e=>{v.Am.error("Failed to send OTP: ".concat(e.message))}}),{mutate:eb}=S({onSuccess:()=>{v.Am.success("Successfully deleted the user's factors"),ec(!1)}}),{mutate:e_,isLoading:eN}=P({onSuccess:()=>{v.Am.success("Successfully unbanned user"),Y(!1)}}),eS=async()=>{if(await (0,M.Vs)(200),!j)return console.error("Project ref is required");eb({projectRef:j,userId:h.id})},eC=()=>void 0===j?console.error("Project ref is required"):void 0===h.id?v.Am.error("Failed to ban user: User ID not found"):void e_({projectRef:j,userId:h.id,banDuration:"none"});return(0,p.useEffect)(()=>{if(void 0!==X){let e=setTimeout(()=>V(void 0),5e3);return()=>clearTimeout(e)}},[X]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(et.w,{user:h,"data-sentry-element":"UserHeader","data-sentry-source-file":"UserOverview.tsx"}),N?(0,n.jsx)(B.J,{type:"warning",label:"User banned until ".concat(i()(h.banned_until).format(er)),className:"border-r-0 border-l-0 rounded-none -mt-px [&_svg]:ml-0.5 mb-0"}):(0,n.jsx)(F.Z,{}),(0,n.jsxs)("div",{className:(0,I.cn)("flex flex-col gap-y-1",es.l),children:[(0,n.jsx)(el,{property:"User UID",value:h.id,"data-sentry-element":"RowData","data-sentry-source-file":"UserOverview.tsx"}),(0,n.jsx)(el,{property:"Created at",value:h.created_at?i()(h.created_at).format(er):void 0,"data-sentry-element":"RowData","data-sentry-source-file":"UserOverview.tsx"}),(0,n.jsx)(el,{property:"Updated at",value:h.updated_at?i()(h.updated_at).format(er):void 0,"data-sentry-element":"RowData","data-sentry-source-file":"UserOverview.tsx"}),(0,n.jsx)(el,{property:"Invited at",value:h.invited_at,"data-sentry-element":"RowData","data-sentry-source-file":"UserOverview.tsx"}),(0,n.jsx)(el,{property:"Confirmation sent at",value:h.confirmation_sent_at,"data-sentry-element":"RowData","data-sentry-source-file":"UserOverview.tsx"}),(0,n.jsx)(el,{property:"Confirmed at",value:h.confirmed_at?i()(h.confirmed_at).format(er):void 0,"data-sentry-element":"RowData","data-sentry-source-file":"UserOverview.tsx"}),(0,n.jsx)(el,{property:"Last signed in",value:h.last_sign_in_at?i()(h.last_sign_in_at).format(er):void 0,"data-sentry-element":"RowData","data-sentry-source-file":"UserOverview.tsx"}),(0,n.jsx)(el,{property:"SSO",value:h.is_sso_user,"data-sentry-element":"RowData","data-sentry-source-file":"UserOverview.tsx"})]}),(0,n.jsxs)("div",{className:(0,I.cn)("flex flex-col !pt-0",es.l),children:[(0,n.jsx)("p",{children:"Provider Information"}),(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"The user has the following providers"})]}),(0,n.jsx)("div",{className:(0,I.cn)("flex flex-col -space-y-1 !pt-0",es.l),children:C.map(e=>{var t,s,r;let a=H.Wm.find(t=>t.title.toLowerCase()===("linkedin"===e.name?"linkedin (oidc)":e.name)),i=Object.keys(null!==(t=null==a?void 0:a.properties)&&void 0!==t?t:{}).find(e=>e.toLowerCase().endsWith("_enabled")),o="email"===e.name?"email":"linkedin"===e.name?"LinkedIn":null!==(s=null==a?void 0:a.title)&&void 0!==s?s:e.name,d=null!==(r=null==eu?void 0:eu[i])&&void 0!==r&&r;return(0,n.jsxs)("div",{className:(0,I.cn)(ea,"items-start justify-start"),children:[e.icon&&(0,n.jsx)("img",{width:16,src:e.icon,alt:"".concat(e.name," auth icon"),className:(0,I.cn)("mt-1.5","github"===e.name?"dark:invert":"")}),(0,n.jsxs)("div",{className:"flex-grow mt-0.5",children:[(0,n.jsx)("p",{className:"capitalize",children:o}),(0,n.jsxs)("p",{className:"text-xs text-foreground-light",children:["Signed in with a ",o," account via"," ","SAML"===o?"SSO":"OAuth"]}),(0,n.jsx)(R.z,{asChild:!0,type:"default",className:"mt-2",children:(0,n.jsxs)(f(),{href:"/project/".concat(j,"/auth/providers?provider=").concat("SAML"===e.name?"SAML 2.0":e.name),children:["Configure ",o," provider"]})})]}),d?(0,n.jsxs)("div",{className:"flex items-center gap-1 rounded-full border border-brand-400 bg-brand-200 py-1 px-1 text-xs text-brand",children:[(0,n.jsx)("span",{className:"rounded-full bg-brand p-0.5 text-xs text-brand-200",children:(0,n.jsx)(l.Z,{strokeWidth:2,size:12})}),(0,n.jsx)("span",{className:"px-1",children:"Enabled"})]}):(0,n.jsx)("div",{className:"rounded-md border border-strong bg-surface-100 py-1 px-3 text-xs text-foreground-lighter",children:"Disabled"})]},e.name)})}),(0,n.jsx)(F.Z,{"data-sentry-element":"Separator","data-sentry-source-file":"UserOverview.tsx"}),(0,n.jsxs)("div",{className:(0,I.cn)("flex flex-col -space-y-1",es.l),children:[b&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eo,{title:"Reset password",description:"Send a password recovery email to the user",button:{icon:(0,n.jsx)(o.Z,{}),text:"Send password recovery",isLoading:ev,disabled:!L,onClick:()=>{j&&ep({projectRef:j,user:h})}},success:"send_recovery"===X?{title:"Password recovery sent",description:"The link in the email is valid for ".concat(ef)}:void 0}),(0,n.jsx)(eo,{title:"Send magic link",description:"Passwordless login via email for the user",button:{icon:(0,n.jsx)(o.Z,{}),text:"Send magic link",isLoading:ey,disabled:!D,onClick:()=>{j&&eg({projectRef:j,user:h})}},success:"send_magic_link"===X?{title:"Magic link sent",description:"The link in the email is valid for ".concat(ef)}:void 0})]}),_&&(0,n.jsx)(eo,{title:"Send OTP",description:"Passwordless login via phone for the user",button:{icon:(0,n.jsx)(o.Z,{}),text:"Send OTP",isLoading:ew,disabled:!O,onClick:()=>{j&&ej({projectRef:j,user:h})}},success:"send_otp"===X?{title:"OTP sent",description:"The link in the OTP SMS is valid for ".concat(ef)}:void 0})]}),(0,n.jsx)(F.Z,{"data-sentry-element":"Separator","data-sentry-source-file":"UserOverview.tsx"}),(0,n.jsxs)("div",{className:(0,I.cn)("flex flex-col",es.l),children:[(0,n.jsx)("p",{children:"Danger zone"}),(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Be wary of the following features as they cannot be undone."})]}),(0,n.jsxs)("div",{className:(0,I.cn)("flex flex-col -space-y-1 !pt-0",es.l),children:[(0,n.jsx)(eo,{title:"Remove MFA factors",description:"This will log the user out of all active sessions",button:{icon:(0,n.jsx)(d.Z,{}),text:"Remove MFA factors",disabled:!q,onClick:()=>ec(!0)},className:"!bg border-destructive-400","data-sentry-element":"RowAction","data-sentry-source-file":"UserOverview.tsx"}),(0,n.jsx)(eo,{title:N?"User is banned until ".concat(i()(h.banned_until).format(er)):"Ban user",description:N?"User has no access to the project until after this date":"Revoke access to the project for a set duration",button:{icon:(0,n.jsx)(c.Z,{}),text:N?"Unban user":"Ban user",disabled:!k,onClick:()=>{N?Y(!0):G(!0)}},className:"!bg border-destructive-400","data-sentry-element":"RowAction","data-sentry-source-file":"UserOverview.tsx"}),(0,n.jsx)(eo,{title:"Delete user",description:"User will no longer have access to the project",button:{icon:(0,n.jsx)(u.Z,{}),type:"danger",text:"Delete user",disabled:!z,onClick:()=>ei(!0)},className:"!bg border-destructive-400","data-sentry-element":"RowAction","data-sentry-source-file":"UserOverview.tsx"})]})]}),(0,n.jsx)(ee.T,{visible:J,selectedUser:h,onClose:()=>ei(!1),onDeleteSuccess:()=>{ei(!1),y()},"data-sentry-element":"DeleteUserModal","data-sentry-source-file":"UserOverview.tsx"}),(0,n.jsx)(W.Z,{visible:ed,variant:"warning",title:"Confirm to remove MFA factors",confirmLabel:"Remove factors",confirmLabelLoading:"Removing",onCancel:()=>ec(!1),onConfirm:()=>eS(),alert:{base:{variant:"warning"},title:"Removing MFA factors is irreversible",description:"This will log the user out of all active sessions."},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"UserOverview.tsx",children:(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:["This is permanent! Are you sure you want to remove the MFA factors for the user"," ",(0,n.jsx)("span",{className:"text-foreground",children:null!==(x=null!==(m=h.email)&&void 0!==m?m:h.phone)&&void 0!==x?x:"this user"}),"?"]})}),(0,n.jsx)($,{visible:K,user:h,onClose:()=>G(!1),"data-sentry-element":"BanUserModal","data-sentry-source-file":"UserOverview.tsx"}),(0,n.jsx)(W.Z,{variant:"warning",visible:Q,title:"Confirm to unban user",loading:eN,confirmLabel:"Unban user",confirmLabelLoading:"Unbanning",onCancel:()=>Y(!1),onConfirm:()=>eC(),"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"UserOverview.tsx",children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"The user will have access to your project again once unbanned. Are you sure you want to unban this user?"})})]})},el=e=>{let{property:t,value:s}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex items-center gap-x-2 group justify-between",children:[(0,n.jsx)("p",{className:" text-foreground-lighter text-xs",children:t}),"boolean"==typeof s?(0,n.jsx)("div",{className:"h-[26px] flex items-center justify-center min-w-[70px]",children:s?(0,n.jsx)("div",{className:"rounded-full w-4 h-4 dark:bg-white bg-black flex items-center justify-center",children:(0,n.jsx)(l.Z,{size:10,className:"text-contrast",strokeWidth:4})}):(0,n.jsx)("div",{className:"rounded-full w-4 h-4 dark:bg-white bg-black flex items-center justify-center",children:(0,n.jsx)(m.Z,{size:10,className:"text-contrast",strokeWidth:4})})}):(0,n.jsxs)("div",{className:"flex items-center gap-x-2 h-[26px] font-mono min-w-[40px]",children:[(0,n.jsx)("p",{className:"text-xs",children:s||"-"}),!!s&&(0,n.jsx)(j.Z,{iconOnly:!0,type:"text",icon:(0,n.jsx)(x.Z,{}),className:"transition opacity-0 group-hover:opacity-100 px-1",text:s})]})]}),(0,n.jsx)(F.Z,{"data-sentry-element":"Separator","data-sentry-source-file":"UserOverview.tsx"})]})},eo=e=>{var t,s,r;let{title:a,description:i,button:o,success:d,className:c}=e,u=null!==(t=null==o?void 0:o.disabled)&&void 0!==t&&t;return(0,n.jsxs)("div",{className:(0,I.cn)(ea,c),"data-sentry-component":"RowAction","data-sentry-source-file":"UserOverview.tsx",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:d?d.title:a}),(0,n.jsx)("p",{className:"text-xs text-foreground-light",children:d?d.description:i})]}),(0,n.jsx)(y.u,{type:null!==(s=null==o?void 0:o.type)&&void 0!==s?s:"default",icon:d?(0,n.jsx)(l.Z,{className:"text-brand"}):o.icon,loading:null!==(r=o.isLoading)&&void 0!==r&&r,onClick:o.onClick,disabled:u,tooltip:{content:{side:"bottom",text:u?"You need additional permissions to ".concat(o.text.toLowerCase()):void 0}},"data-sentry-element":"ButtonTooltip","data-sentry-source-file":"UserOverview.tsx",children:o.text})]})}},70107:function(e,t,s){s.d(t,{l:function(){return A},i:function(){return D}});var n=s(97458),r=s(35808),a=s(98686),i=s(52983),l=s(89429),o=s(90839),d=s(92240),c=s(65092),u=s(56740),m=s(23618),x=s(5211),h=s(4839),f=s(83145),p=s.n(f),v=s(12436),g=s(89831),y=s(63621),j=s(57703),w=s(11221),b=s(7756),_=s(33526),N=s(54354),S=s(5430),C=s(359),U=s(25024);let k=e=>{let{user:t}=e,{ref:s}=(0,v.UO)(),{filters:r,setFilters:a}=(0,U.k)(),{logData:l,isSuccess:d,isLoading:u,refresh:m}=(0,j.Z)({projectRef:s,table:g.ae.auth,filterOverride:{search_query:t.id},limit:5});return(0,i.useEffect)(()=>{t.id&&a({...r,search_query:t.id})},[t.id]),(0,n.jsxs)("div",{"data-sentry-component":"UserLogs","data-sentry-source-file":"UserLogs.tsx",children:[(0,n.jsx)(S.w,{user:t,"data-sentry-element":"UserHeader","data-sentry-source-file":"UserLogs.tsx"}),(0,n.jsx)(w.Z,{"data-sentry-element":"Separator","data-sentry-source-file":"UserLogs.tsx"}),(0,n.jsxs)("div",{className:(0,c.cn)("flex flex-col gap-y-3",A),children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:"Authentication logs"}),(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Latest logs from authentication for this user in the past hour"})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(o.z,{type:"status_code"in r?"default":"secondary",className:"rounded-r-none border-r-0",disabled:u,onClick:()=>a({search_query:t.id}),"data-sentry-element":"Button","data-sentry-source-file":"UserLogs.tsx",children:"Show all"}),(0,n.jsx)("div",{className:"border-button border border-l-0 py-3"}),(0,n.jsx)(o.z,{type:"status_code"in r?"secondary":"default",className:"rounded-l-none border-l-0",disabled:u,onClick:()=>a({search_query:t.id,status_code:{client_error:!0,server_error:!0}}),"data-sentry-element":"Button","data-sentry-source-file":"UserLogs.tsx",children:"Error only"})]}),(0,n.jsx)(o.z,{type:"default",loading:u,disabled:u,icon:(0,n.jsx)(x.Z,{}),onClick:()=>m(),"data-sentry-element":"Button","data-sentry-source-file":"UserLogs.tsx",children:"Refresh"})]}),u&&!d?(0,n.jsx)(y.A,{}):0===l.length?(0,n.jsx)(_.J,{type:"note",title:"No authentication logs available for this user",description:"Auth events such as logging in will be shown here"}):(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"border border-b-0 rounded-t-md divide-y overflow-hidden",children:l.map(e=>{var t;let r=(null!==(t=e.status)&&void 0!==t?t:"-").toString(),a=r.startsWith("4"),i=r.startsWith("5");return(0,n.jsxs)("div",{className:"flex items-center transition font-mono px-2 py-1.5 bg-surface-100 divide-x",children:[(0,n.jsx)("p",{className:"text-xs text-foreground-light min-w-[125px] w-[125px] px-1",children:(0,n.jsx)(N.c,{utcTimestamp:e.timestamp/1e3})}),(0,n.jsx)("div",{className:"flex items-center text-xs text-foreground-light h-[22px] min-w-[70px] w-[70px] px-2",children:(0,n.jsxs)("div",{className:(0,c.cn)("flex items-center justify-center gap-x-1",!!e.status&&"border px-1 py-0.5 rounded",a?"text-warning border-warning bg-warning-300":i?"text-destructive border-destructive bg-destructive-300":""),children:[(a||i)&&(0,n.jsx)(b.ku,{hideBackground:!0,className:(0,c.cn)(a&&"text-warning-600")}),r]})}),(0,n.jsxs)("p",{className:"group relative flex items-center py-1.5 text-xs text-foreground-light px-2 truncate w-full",children:["".concat(e.path," | ").concat(e.msg),(0,n.jsx)(C.u,{type:"outline",asChild:!0,tooltip:{content:{text:"Open in logs"}},className:"px-1.5 absolute right-0 top-0 opacity-0 group-hover:opacity-100 transition bg-background focus-visible:opacity-100",children:(0,n.jsx)(p(),{href:"/project/".concat(s,"/logs/auth-logs?log=").concat(e.id),children:(0,n.jsx)(h.Z,{size:"12",className:"text-foreground-light"})})})]})]},e.id)})}),(0,n.jsx)(o.z,{block:!0,asChild:!0,type:"outline",className:"transition rounded-t-none text-foreground-light hover:text-foreground",children:(0,n.jsx)(p(),{href:"/project/".concat(s,"/logs/auth-logs?s=").concat(t.id),children:"See more logs"})})]})]})]})},A="px-5 py-5",D=e=>{let{selectedUser:t,onClose:s}=e,[x,h]=(0,i.useState)("overview"),[f,p]=(0,i.useState)(""),v=t?Object.entries(t).filter(e=>{let[t,s]=e;return t.toLowerCase().includes(f.toLowerCase())||"string"==typeof s&&s.toLowerCase().includes(f.toLowerCase())}).reduce((e,t)=>{let[s,n]=t;return void 0!==n&&(e[s]=n),e},{}):{};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.Dp,{withHandle:!0,"data-sentry-element":"ResizableHandle","data-sentry-source-file":"UserPanel.tsx"}),(0,n.jsxs)(l.ee,{defaultSize:30,maxSize:45,minSize:30,className:"bg-studio border-t","data-sentry-element":"ResizablePanel","data-sentry-source-file":"UserPanel.tsx",children:[(0,n.jsx)(o.z,{type:"text",className:"absolute top-3 right-3 px-1",icon:(0,n.jsx)(a.Z,{}),onClick:()=>s(),"data-sentry-element":"Button","data-sentry-source-file":"UserPanel.tsx"}),(0,n.jsxs)(d.mQ,{value:x,className:"flex flex-col h-full",onValueChange:e=>h(e),"data-sentry-element":"Tabs_Shadcn_","data-sentry-source-file":"UserPanel.tsx",children:[(0,n.jsxs)(d.dr,{className:"px-5 flex gap-x-4 min-h-[46px]","data-sentry-element":"TabsList_Shadcn_","data-sentry-source-file":"UserPanel.tsx",children:[(0,n.jsx)(d.SP,{value:"overview",className:"px-0 pb-0 h-full text-xs  data-[state=active]:bg-transparent !shadow-none","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"UserPanel.tsx",children:"Overview"}),(0,n.jsx)(d.SP,{value:"logs",className:"px-0 pb-0 h-full text-xs data-[state=active]:bg-transparent !shadow-none","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"UserPanel.tsx",children:"Logs"}),(0,n.jsx)(d.SP,{value:"raw",className:"px-0 pb-0 h-full text-xs data-[state=active]:bg-transparent !shadow-none","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"UserPanel.tsx",children:"Raw JSON"})]}),(0,n.jsx)(d.nU,{value:"overview",className:(0,c.cn)("mt-0 flex-grow min-h-0 overflow-y-auto"),"data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"UserPanel.tsx",children:t&&(0,n.jsx)(m.wC,{user:t,onDeleteSuccess:s})}),(0,n.jsx)(d.nU,{value:"logs",className:(0,c.cn)("mt-0 flex-grow min-h-0 overflow-y-auto"),"data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"UserPanel.tsx",children:t&&(0,n.jsx)(k,{user:t})}),(0,n.jsxs)(d.nU,{value:"raw",className:(0,c.cn)("mt-0 flex-grow min-h-0 overflow-y-auto",A),"data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"UserPanel.tsx",children:[(0,n.jsxs)("div",{className:"flex items-center mb-2",children:[(0,n.jsx)(u.I,{autoFocus:!0,type:"text",placeholder:"Filter...",value:f,onChange:e=>p(e.target.value),className:"mr-2","data-sentry-element":"Input_Shadcn_","data-sentry-source-file":"UserPanel.tsx"}),(0,n.jsx)(o.z,{type:"text",disabled:!f,onClick:()=>p(""),className:"text-xs","data-sentry-element":"Button","data-sentry-source-file":"UserPanel.tsx",children:"Clear"})]}),(0,n.jsx)(r.c,{className:"javascript","data-sentry-element":"SimpleCodeBlock","data-sentry-source-file":"UserPanel.tsx",children:JSON.stringify(v,null,2)})]})]})]})]})}},40662:function(e,t,s){s.d(t,{Rs:function(){return P},Bi:function(){return C},E$:function(){return z},Gf:function(){return O},KG:function(){return S},Bn:function(){return A}});var n=s(97458),r=s(28977),a=s.n(r),i=s(73981),l=s(57304),o=s(74304),d=s(44914),c=s(37756),u=s(45536),m=s(61893),x=s(65092),h=s(94669),f=s(98601),p=s(90829),v=s(68297),g=s(52983),y=s(14500),j=s(90839);let w=e=>{let{col:t,setSortByValue:s}=e,r=(0,g.useRef)(0),[a,i]=(0,g.useState)(!1);return(0,g.useEffect)(()=>{r.current=Number(new Date)},[a]),(0,n.jsxs)("div",{className:"flex items-center justify-between font-normal text-xs w-full","data-sentry-component":"HeaderCell","data-sentry-source-file":"UsersGridComponents.tsx",children:[(0,n.jsx)("div",{className:"flex items-center gap-x-2",children:(0,n.jsx)("p",{className:"!text-foreground",children:t.name})}),["created_at","email","phone"].includes(t.id)&&(0,n.jsxs)(y.h_,{open:a,onOpenChange:e=>{!1===e&&Number(new Date)-r.current>100&&i(e)},children:[(0,n.jsx)(y.$F,{asChild:!0,children:(0,n.jsx)(j.z,{type:"text",icon:(0,n.jsx)(f.Z,{}),className:"p-0 h-5 w-5",onClick:()=>i(!a)})}),(0,n.jsxs)(y.AW,{className:"w-36",children:[(0,n.jsxs)(y.Xi,{className:"flex items-center gap-x-2",onClick:()=>{i(!1),s("".concat(t.id,":desc"))},children:[(0,n.jsx)(p.Z,{size:14}),"Sort descending"]}),(0,n.jsxs)(y.Xi,{className:"flex items-center gap-x-2",onClick:()=>{i(!1),s("".concat(t.id,":asc"))},children:[(0,n.jsx)(v.Z,{size:14}),"Sort ascending"]})]})]})]})};var b=s(57798);let _="https://avatars.githubusercontent.com",N=[_,"https://lh3.googleusercontent.com"],S=e=>{let{currentTarget:t}=e;return t.scrollTop+10>=t.scrollHeight-t.clientHeight},C=e=>e.map(e=>{var t,s;let n=null!==(s=null===(t=e.raw_app_meta_data)||void 0===t?void 0:t.provider)&&void 0!==s?s:"",r=e.providers.map(e=>e.startsWith("sso")?"SAML":e);return{id:e.id,email:e.email,phone:e.phone,created_at:e.created_at,last_sign_in_at:e.last_sign_in_at,providers:e.is_anonymous?"-":r,provider_icons:r.map(e=>"email"===e?"".concat(c.GW,"/img/icons/email-icon2.svg"):"SAML"===e?"".concat(c.GW,"/img/icons/saml-icon.svg"):A[e]?"".concat(c.GW,"/img/icons/").concat(A[e],".svg"):void 0).filter(Boolean),provider_type:e.is_anonymous?"Anonymous":"email"===n?"-":D.includes(n)?"Social":T.includes(n)?"Phone":"-",img:z(e),name:O(e)}}),U=[{email:"email-icon2"},{apple:"apple-icon"},{azure:"microsoft-icon"},{bitbucket:"bitbucket-icon"},{discord:"discord-icon"},{facebook:"facebook-icon"},{figma:"figma-icon"},{github:"github-icon"},{gitlab:"gitlab-icon"},{google:"google-icon"},{kakao:"kakao-icon"},{keycloak:"keycloak-icon"},{linkedin:"linkedin-icon"},{notion:"notion-icon"},{twitch:"twitch-icon"},{twitter:"twitter-icon"},{slack:"slack-icon"},{spotify:"spotify-icon"},{workos:"workos-icon"},{zoom:"zoom-icon"}],k=[{twilio:"twilio-icon"},{messagebird:"messagebird-icon"},{textlocal:"messagebird-icon"},{vonage:"messagebird-icon"},{twilioverify:"twilio-verify-icon"}],A=Object.values([...U,...k]).reduce((e,t)=>{let[[s,n]]=Object.entries(t);return{...e,[s]:n}},{}),D=U.map(e=>{let[t]=Object.keys(e);return t}),T=k.map(e=>{let[t]=Object.keys(e);return t});function L(e){if(e){if("string"==typeof e)return e;if(Array.isArray(e))return e.map(e=>L(e)).join(" ");try{return JSON.stringify(e)}catch(e){}}}function O(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-",{custom_claims:n,displayName:r,display_name:a,fullName:i,full_name:l,familyName:o,family_name:d,givenName:c,given_name:u,surname:m,lastName:x,last_name:h,firstName:f,first_name:p}=null!==(t=e.raw_user_meta_data)&&void 0!==t?t:{},{displayName:v,display_name:g,fullName:y,full_name:j,familyName:w,family_name:b,givenName:_,given_name:N,surname:S,lastName:C,last_name:U,firstName:k,first_name:A}=null!=n?n:{},D=L(o||d||m||x||h||w||b||S||C||U),T=L(c||u||f||p||_||N||k||A);return L(r||a||v||g||i||l||y||j||T&&D&&"".concat(T," ").concat(D)||D||T)||s}function z(e){var t;let{avatarUrl:s,avatarURL:n,avatar_url:r,profileUrl:a,profileURL:i,profile_url:l,profileImage:o,profile_image:d,profileImageUrl:c,profileImageURL:u,profile_image_url:m}=null!==(t=e.raw_user_meta_data)&&void 0!==t?t:{},x=s||n||r||o||d||a||i||l||c||u||m||"";if("string"!=typeof x)return;let h=N.some(e=>x.startsWith(e));try{let e=new URL(x);return e.searchParams.set("s","24"),h?x.startsWith(_)?e.href:x:void 0}catch(e){return h?x:void 0}}let P=e=>{var t;let{config:s,users:r,visibleColumns:c=[],setSortByValue:f,onSelectDeleteUser:p}=e,v=null!==(t=s.map(e=>e.id))&&void 0!==t?t:b.O.map(e=>e.id),g=b.O.map(e=>{var t,c,v;let g=s.find(t=>t.id===e.id);return{key:e.id,name:e.name,resizable:null===(t=e.resizable)||void 0===t||t,sortable:!1,draggable:!0,width:null!==(c=null==g?void 0:g.width)&&void 0!==c?c:e.width,minWidth:null!==(v=e.minWidth)&&void 0!==v?v:120,headerCellClass:"z-50 outline-none !shadow-none",renderHeaderCell:()=>{if("img"!==e.id)return(0,n.jsx)(w,{col:e,setSortByValue:f})},renderCell:t=>{let{row:s}=t,[c,f]=(0,d.Gt)(),v=null==s?void 0:s[e.id],g=null==r?void 0:r.find(e=>e.id===s.id),y=null!==v&&["created_at","last_sign_in_at"].includes(e.id)?a()(v).format("ddd DD MMM YYYY HH:mm:ss [GMT]ZZ"):Array.isArray(v)?v.join(", "):v,j=!!(null==g?void 0:g.confirmed_at);return"img"===e.id?(0,n.jsxs)("div",{className:"flex items-center justify-center gap-x-2",children:[(0,n.jsx)(m.X,{checked:c,onClick:e=>{e.stopPropagation(),f({row:s,type:"ROW",checked:!c,isShiftClick:e.shiftKey})}}),(0,n.jsx)("div",{className:(0,x.cn)("flex items-center justify-center w-6 h-6 rounded-full bg-center bg-cover bg-no-repeat",s.img?"border":"bg-selection"),style:{backgroundImage:s.img?"url('".concat(s.img,"')"):"none"},children:!s.img&&(0,n.jsx)(i.Z,{size:12})})]}):(0,n.jsxs)(h.xV,{children:[(0,n.jsx)(h.W4,{asChild:!0,children:(0,n.jsxs)("div",{className:(0,x.cn)("w-full flex items-center text-xs",e.id.includes("provider")?"capitalize":""),children:["providers"===e.id&&s.provider_icons.map((e,t)=>{let r=s.providers[t];return(0,n.jsx)("div",{className:"min-w-6 min-h-6 rounded-full border flex items-center justify-center bg-surface-75",style:{marginLeft:0===t?0:"-8px",zIndex:s.provider_icons.length-t},children:(0,n.jsx)("img",{width:16,src:e,alt:"".concat(r," auth icon"),className:(0,x.cn)("github"===r&&"dark:invert")},"".concat(null==g?void 0:g.id,"-").concat(r))})}),"last_sign_in_at"!==e.id||j?(0,n.jsx)("p",{className:(0,x.cn)("providers"===e.id&&"ml-1"),children:null===y?"-":y}):(0,n.jsx)("p",{className:"text-foreground-lighter",children:"Waiting for verification"})]})}),(0,n.jsxs)(h.h_,{onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)(h.Zo,{className:"gap-x-2",onFocusCapture:e=>e.stopPropagation(),onSelect:()=>{let t="providers"===e.id?s.providers.join(", "):y;(0,u.vQ)(t)},children:[(0,n.jsx)(l.Z,{size:12}),(0,n.jsxs)("span",{children:["Copy ","id"===e.id?e.name:e.name.toLowerCase()]})]}),(0,n.jsx)(h.uP,{}),(0,n.jsxs)(h.Zo,{className:"gap-x-2",onFocusCapture:e=>e.stopPropagation(),onSelect:()=>{g&&p(g)},children:[(0,n.jsx)(o.Z,{size:12}),(0,n.jsx)("span",{children:"Delete user"})]})]})]})}}}),y=g.find(e=>"img"===e.key);return v.length>0&&(g=g.filter(e=>v.includes(e.key)).sort((e,t)=>v.indexOf(e.key)-v.indexOf(t.key))),0===c.length?g:[y].concat(g.filter(e=>c.includes(e.key)))}},57798:function(e,t,s){s.d(t,{O:function(){return eb},r:function(){return e_}});var n=s(97458),r=s(36457),a=s(12832),i=s(74304),l=s(98686),o=s(77270),d=s(70029),c=s(38273),u=s(5211),m=s(29285),x=s(52675),h=s(52983),f=s(44914),p=s(34549),v=s(12436),g=s(65921),y=s(88971),j=s(5529),w=s(26233),b=s(359),_=s(96060),N=s(24083),S=s(26600),C=s(6927),U=s(28894),k=s(25878);let A=e=>{let{filter:t,keywords:s,providers:n}=e,r=[];if(s&&""!==s){let e=s.replaceAll("'","''");r.push("id::text ilike '%".concat(e,"%' or email ilike '%").concat(e,"%' or phone ilike '%").concat(e,"%'"))}"verified"===t?r.push("email_confirmed_at IS NOT NULL or phone_confirmed_at IS NOT NULL"):"anonymous"===t?r.push("is_anonymous is true"):"unverified"===t&&r.push("email_confirmed_at IS NULL AND phone_confirmed_at IS NULL"),n&&n.length>0&&(n.includes("saml 2.0")?r.push("(select jsonb_agg(case when value ~ '^sso' then 'sso' else value end) from jsonb_array_elements_text((raw_app_meta_data ->> 'providers')::jsonb)) ?| array[".concat(n.map(e=>"saml 2.0"===e?"'sso'":"'".concat(e,"'")).join(", "),"]").trim()):r.push("(raw_app_meta_data->>'providers')::jsonb ?| array[".concat(n.map(e=>"'".concat(e,"'")).join(", "),"]")));let a=r.map(e=>"(".concat(e,")")).join(" and ");return"".concat("select count(*) from auth.users").concat(r.length>0?" where ".concat(a):"",";")};async function D(e,t){var s;let{projectRef:n,connectionString:r,keywords:a,filter:i,providers:l}=e,o=A({filter:i,keywords:a,providers:l}),{result:d}=await (0,k.R)({projectRef:n,connectionString:r,sql:o,queryKey:["users-count"]},t),c=null==d?void 0:null===(s=d[0])||void 0===s?void 0:s.count;if("number"!=typeof c)throw Error("Error fetching users count");return c}let T=function(e){let{projectRef:t,connectionString:s,keywords:n,filter:r,providers:a}=e,{enabled:i=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,U.a)(S.o.usersCount(t,{keywords:n,filter:r,providers:a}),e=>{let{signal:i}=e;return D({projectRef:t,connectionString:s,keywords:n,filter:r,providers:a},i)},{enabled:i&&void 0!==t,...l})};var L=s(33372),O=s(92261),z=s(37756),P=s(90839),Z=s(22714),E=s(65092),M=s(14500),I=s(27246),F=s(89429),R=s(85682),B=s(32002),W=s(89129),H=s(198),q=s(98601),X=s(49475),V=s(14346),K=s(90817),G=s(40577),Q=s(78751),Y=s(11024),J=s(86848),$=s(5394),ee=s(64618),et=s(6464);async function es(e){let{projectRef:t,user:s}=e,{data:n,error:r}=await (0,et.v_)("/platform/auth/{ref}/users",{params:{path:{ref:t}},body:{email:s.email,password:s.password,email_confirm:s.autoConfirmUser}});return r&&(0,et.S3)(r),n}let en=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,r.NL)();return(0,ee.D)(e=>es(e),{async onSuccess(t,s,r){let{projectRef:a}=s;await Promise.all([n.invalidateQueries(S.o.usersInfinite(a)),n.invalidateQueries(S.o.usersCount(a))]),await (null==e?void 0:e(t,s,r))},async onError(e,s,n){void 0===t?p.Am.error("Failed to create user: ".concat(e.message)):t(e,s,n)},...s})};var er=s(36210),ea=s(49142),ei=s(56740),el=s(61893);let eo=$.Ry({email:$.Z_().min(1,"Email is required").email("Must be a valid email address"),password:$.Z_().min(1,"Password is required"),autoConfirmUser:$.O7()});var ed=e=>{let{visible:t,setVisible:s}=e,{ref:r}=(0,v.UO)(),a=(0,K.Xo)(H.KA.AUTH_EXECUTE,"create_user"),{mutate:i,isLoading:l}=en({onSuccess(e){p.Am.success("Successfully created user: ".concat(e.email)),d.reset({email:"",password:"",autoConfirmUser:!0}),s(!1)}}),o=async e=>{if(!r)return console.error("Project ref is required");i({projectRef:r,user:e})},d=(0,J.cI)({resolver:(0,Q.F)(eo),defaultValues:{email:"",password:"",autoConfirmUser:!0}});return(0,n.jsx)(er.Vq,{open:t,onOpenChange:s,"data-sentry-element":"Dialog","data-sentry-component":"CreateUserModal","data-sentry-source-file":"CreateUserModal.tsx",children:(0,n.jsxs)(er.cZ,{size:"small","data-sentry-element":"DialogContent","data-sentry-source-file":"CreateUserModal.tsx",children:[(0,n.jsx)(er.fK,{"data-sentry-element":"DialogHeader","data-sentry-source-file":"CreateUserModal.tsx",children:(0,n.jsx)(er.$N,{"data-sentry-element":"DialogTitle","data-sentry-source-file":"CreateUserModal.tsx",children:"Create a new user"})}),(0,n.jsx)(er.P3,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"CreateUserModal.tsx"}),(0,n.jsx)(ea.l0,{...d,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"CreateUserModal.tsx",children:(0,n.jsxs)("form",{id:"create-user",className:"flex flex-col gap-y-4 p-6",onSubmit:d.handleSubmit(o),children:[(0,n.jsx)(ea.Wi,{name:"email",control:d.control,render:e=>{let{field:t}=e;return(0,n.jsxs)(ea.xJ,{className:"flex flex-col gap-1",children:[(0,n.jsx)(ea.lX,{children:"Email address"}),(0,n.jsx)(ea.NI,{children:(0,n.jsxs)("div",{className:"items-center relative",children:[(0,n.jsx)(X.Z,{size:18,className:"absolute left-2 top-1/2 transform -translate-y-1/2",strokeWidth:1.5}),(0,n.jsx)(ei.I,{autoFocus:!0,...t,autoComplete:"off",type:"email",name:"email",placeholder:"user@example.com",disabled:l,className:"pl-8"})]})}),(0,n.jsx)(ea.zG,{})]})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateUserModal.tsx"}),(0,n.jsx)(ea.Wi,{name:"password",control:d.control,render:e=>{let{field:t}=e;return(0,n.jsxs)(ea.xJ,{className:"flex flex-col gap-1",children:[(0,n.jsx)(ea.lX,{children:"User Password"}),(0,n.jsx)(ea.NI,{children:(0,n.jsxs)("div",{className:"items-center relative",children:[(0,n.jsx)(Y.Z,{size:18,className:"absolute left-2 top-1/2 transform -translate-y-1/2",strokeWidth:1.5}),(0,n.jsx)(ei.I,{...t,autoComplete:"new-password",type:"password",name:"password",placeholder:"••••••••",disabled:l,className:"pl-8"})]})}),(0,n.jsx)(ea.zG,{})]})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateUserModal.tsx"}),(0,n.jsx)(ea.Wi,{name:"autoConfirmUser",control:d.control,render:e=>{let{field:t}=e;return(0,n.jsxs)(ea.xJ,{className:"flex items-center gap-x-2",children:[(0,n.jsx)(ea.NI,{children:(0,n.jsx)(el.X,{checked:t.value,onCheckedChange:e=>t.onChange(e)})}),(0,n.jsx)(ea.lX,{children:"Auto Confirm User?"})]})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateUserModal.tsx"}),(0,n.jsx)(ea.lX,{"data-sentry-element":"FormLabel_Shadcn_","data-sentry-source-file":"CreateUserModal.tsx",children:(0,n.jsx)("p",{className:"text-sm text-foreground-lighter",children:"A confirmation email will not be sent when creating a user via this form."})}),(0,n.jsx)(P.z,{block:!0,size:"small",htmlType:"submit",loading:l,disabled:!a||l,"data-sentry-element":"Button","data-sentry-source-file":"CreateUserModal.tsx",children:"Create user"})]})})]})})};async function ec(e){let{projectRef:t,email:s}=e,{data:n,error:r}=await (0,et.v_)("/platform/auth/{ref}/invite",{params:{path:{ref:t}},body:{email:s}});return r&&(0,et.S3)(r),n}let eu=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,r.NL)();return(0,ee.D)(e=>ec(e),{async onSuccess(t,s,r){let{projectRef:a}=s;await Promise.all([n.invalidateQueries(S.o.usersInfinite(a)),n.invalidateQueries(S.o.usersCount(a))]),await (null==e?void 0:e(t,s,r))},async onError(e,s,n){void 0===t?p.Am.error("Failed to invite user: ".concat(e.message)):t(e,s,n)},...s})};var em=s(42155),ex=s(19540),eh=s(51571),ef=e=>{let{visible:t,setVisible:s}=e,{ref:r}=(0,v.UO)(),{mutate:a,isLoading:i}=eu({onSuccess:(e,t)=>{p.Am.success("Sent invite email to ".concat(t.email)),s(!1)}}),l=(0,K.Xo)(H.KA.AUTH_EXECUTE,"invite_user"),o=async e=>{if(!r)return console.error("Project ref is required");a({projectRef:r,email:e.email})};return(0,n.jsx)(em.Z,{hideFooter:!0,size:"small",visible:t,header:"Invite a new user",onCancel:()=>s(!t),"data-sentry-element":"Modal","data-sentry-component":"InviteUserModal","data-sentry-source-file":"InviteUserModal.tsx",children:(0,n.jsx)(ex.Z,{validateOnBlur:!1,initialValues:{email:""},validate:e=>{let t={};return 0===e.email.length?t.email="Please enter a valid email":/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(e.email)||(t.email="".concat(e.email," is an invalid email")),t},onSubmit:o,"data-sentry-element":"Form","data-sentry-source-file":"InviteUserModal.tsx",children:()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(em.Z.Content,{children:(0,n.jsx)(eh.Z,{id:"email",className:"w-full",label:"User email",icon:(0,n.jsx)(X.Z,{}),type:"email",name:"email",placeholder:"User email"})}),(0,n.jsx)(em.Z.Content,{children:(0,n.jsx)(P.z,{block:!0,size:"small",htmlType:"submit",loading:i,disabled:!l||i,children:"Invite user"})})]})})},"invite-user-modal")},ep=()=>{let e=(0,K.Xo)(H.KA.AUTH_EXECUTE,"invite_user"),t=(0,K.Xo)(H.KA.AUTH_EXECUTE,"create_user"),[s,r]=(0,h.useState)(!1),[a,i]=(0,h.useState)(!1);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(M.h_,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"AddUserDropdown.tsx",children:[(0,n.jsx)(M.$F,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"AddUserDropdown.tsx",children:(0,n.jsx)(P.z,{type:"primary",iconRight:(0,n.jsx)(q.Z,{size:14,strokeWidth:1.5}),"data-sentry-element":"Button","data-sentry-source-file":"AddUserDropdown.tsx",children:"Add user"})}),(0,n.jsxs)(M.AW,{side:"bottom",align:"end",className:"w-40","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"AddUserDropdown.tsx",children:[(0,n.jsxs)(G.u,{"data-sentry-element":"Tooltip","data-sentry-source-file":"AddUserDropdown.tsx",children:[(0,n.jsx)(G.aJ,{asChild:!0,"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"AddUserDropdown.tsx",children:(0,n.jsxs)(M.Xi,{className:"space-x-2 !pointer-events-auto",disabled:!e,onClick:()=>{e&&r(!0)},"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"AddUserDropdown.tsx",children:[(0,n.jsx)(X.Z,{size:14,"data-sentry-element":"Mail","data-sentry-source-file":"AddUserDropdown.tsx"}),(0,n.jsx)("p",{children:"Send invitation"})]})}),!e&&(0,n.jsx)(G._v,{side:"left",children:"You need additional permissions to invite users"})]}),(0,n.jsxs)(G.u,{"data-sentry-element":"Tooltip","data-sentry-source-file":"AddUserDropdown.tsx",children:[(0,n.jsx)(G.aJ,{asChild:!0,"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"AddUserDropdown.tsx",children:(0,n.jsxs)(M.Xi,{className:"space-x-2 !pointer-events-auto",disabled:!t,onClick:()=>{t&&i(!0)},"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"AddUserDropdown.tsx",children:[(0,n.jsx)(V.Z,{size:14,"data-sentry-element":"UserPlus","data-sentry-source-file":"AddUserDropdown.tsx"}),(0,n.jsx)("p",{children:"Create new user"})]})}),!t&&(0,n.jsx)(G._v,{side:"left",children:"You need additional permissions to create users"})]})]})]}),(0,n.jsx)(ef,{visible:s,setVisible:r,"data-sentry-element":"InviteUserModal","data-sentry-source-file":"AddUserDropdown.tsx"}),(0,n.jsx)(ed,{visible:a,setVisible:i,"data-sentry-element":"CreateUserModal","data-sentry-source-file":"AddUserDropdown.tsx"})]})},ev=s(39988),eg=s(70107),ey=s(94102);let ej=ey.Wm.map(e=>({name:e.title,value:"Slack (OIDC)"===e.title?"slack_oidc":"LinkedIn (OIDC)"===e.title?"linkedin_oidc":e.title.toLowerCase(),icon:"".concat(z.GW,"/img/icons/").concat(e.misc.iconKey,".svg"),iconClass:"GitHub"===e.title?"dark:invert":""})).concat(ey.Px.properties.SMS_PROVIDER.enum.map(e=>({name:e.label,value:e.value,icon:"".concat(z.GW,"/img/icons/").concat(e.icon),iconClass:""})));var ew=s(40662);let eb=[{id:"img",name:"",minWidth:95,width:95,resizable:!1},{id:"id",name:"UID",width:280},{id:"name",name:"Display name",minWidth:0,width:150},{id:"email",name:"Email",width:300},{id:"phone",name:"Phone"},{id:"providers",name:"Providers",minWidth:150},{id:"provider_type",name:"Provider type",minWidth:150},{id:"created_at",name:"Created at",width:260},{id:"last_sign_in_at",name:"Last sign in at",width:260}],e_=()=>{var e,t;let s=(0,r.NL)(),{ref:U}=(0,v.UO)(),{project:k}=(0,y.d2)(),A=(0,h.useRef)(null),D=(0,h.useRef)(0),H=(0,g.cg)(),[q,X]=(0,h.useState)([]),[V,K]=(0,h.useState)(""),[G,Q]=(0,h.useState)("all"),[Y,J]=(0,h.useState)(""),[$,ee]=(0,h.useState)([]),[et,es]=(0,h.useState)([]),[en,er]=(0,h.useState)("created_at:desc"),[ea,ei]=(0,h.useState)(),[el,eo]=(0,h.useState)(new Set([])),[ed,ec]=(0,h.useState)(),[eu,em]=(0,h.useState)(!1),[ex,eh]=(0,h.useState)(!1),[ef,ey,{isSuccess:e_,isError:eN,error:eS}]=(0,O.l)(z.dA.AUTH_USERS_COLUMNS_CONFIGURATION(null!=U?U:""),null),[eC,eU]=en.split(":"),{data:ek,error:eA,isSuccess:eD,isLoading:eT,isRefetching:eL,isError:eO,isFetchingNextPage:ez,refetch:eP,hasNextPage:eZ,fetchNextPage:eE}=(0,L.x7)({projectRef:U,connectionString:null==k?void 0:k.connectionString,keywords:Y,filter:"all"===G?void 0:G,providers:et,sort:eC,order:eU},{keepPreviousData:!!Y,staleTime:1/0}),{data:eM}=T({projectRef:U,connectionString:null==k?void 0:k.connectionString,keywords:Y,filter:"all"===G?void 0:G,providers:et}),{mutateAsync:eI}=(0,C.T)(),eF=(0,h.useMemo)(()=>{var e;return null!==(e=null==ek?void 0:ek.pages.flatMap(e=>e.result))&&void 0!==e?e:[]},[null==ek?void 0:ek.pages]),eR=eF.find(e=>e.id===[...el][0]),eB=()=>{K(""),J("")},eW=(e,t,s)=>{let n=e.slice(),[r]=n.splice(t,1);return n.splice(s,0,r),n},eH=(0,a.Z)((e,t)=>{"toggle"===e?ey(t.columns.map(e=>({id:e.key,width:e.width}))):"resize"===e?ey(q.map((e,s)=>({id:e.key,width:s===t.idx?t.width:e.width}))):"reorder"===e&&ey(t.columns.map(e=>({id:e.key,width:e.width})))},500),eq=async()=>{if(!U)return console.error("Project ref is required");let e=[...el];eh(!0);try{await Promise.all(e.map(e=>eI({projectRef:U,userId:e,skipInvalidation:!0}))),await Promise.all([s.invalidateQueries(S.o.usersInfinite(U)),s.invalidateQueries(S.o.usersCount(U))]),p.Am.success("Successfully deleted the selected ".concat(el.size," user").concat(el.size>1?"s":"")),em(!1),eo(new Set([])),e.includes(ea)&&ei(void 0)}catch(e){p.Am.error("Failed to delete selected users: ".concat(e.message)),eh(!1)}};return(0,h.useEffect)(()=>{if(!eL&&(e_||eN&&eS.message.includes("data is undefined"))){let e=(0,ew.Rs)({config:null!=ef?ef:[],users:null!=eF?eF:[],visibleColumns:$,setSortByValue:er,onSelectDeleteUser:ec});X(e),e.length<eb.length&&ee(e.filter(e=>"img"!==e.key).map(e=>e.key))}},[eD,eL,e_,eN,eS,eF,el]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"h-full flex flex-col",children:[(0,n.jsx)(N.p,{className:"py-4 px-6 !mb-0",title:"Users","data-sentry-element":"FormHeader","data-sentry-source-file":"UsersV2.tsx"}),(0,n.jsx)("div",{className:"bg-surface-200 py-3 px-4 md:px-6 flex flex-col lg:flex-row lg:items-center justify-between gap-2 border-t",children:el.size>0?(0,n.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,n.jsxs)(P.z,{type:"default",icon:(0,n.jsx)(i.Z,{}),onClick:()=>em(!0),children:["Delete ",el.size," users"]}),(0,n.jsx)(b.u,{type:"default",icon:(0,n.jsx)(l.Z,{}),className:"px-1.5",onClick:()=>eo(new Set([])),tooltip:{content:{side:"bottom",text:"Cancel selection"}}})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,n.jsx)(R.I,{size:"tiny",className:"w-52 pl-7 bg-transparent",iconContainerClassName:"pl-2",icon:(0,n.jsx)(o.Z,{size:14,className:"text-foreground-lighter"}),placeholder:"Search email, phone or UID",value:V,onChange:e=>K(e.target.value),onKeyDown:e=>{"Enter"===e.code&&(K(V.trim()),J(V.trim().toLocaleLowerCase()))},actions:[V&&(0,n.jsx)(P.z,{size:"tiny",type:"text",icon:(0,n.jsx)(l.Z,{}),onClick:()=>eB(),className:"p-0 h-5 w-5"})]}),(0,n.jsxs)(Z.Ph,{value:G,onValueChange:e=>Q(e),children:[(0,n.jsx)(Z.i4,{size:"tiny",className:(0,E.cn)("w-[140px] !bg-transparent","all"===G&&"border-dashed"),children:(0,n.jsx)(Z.ki,{})}),(0,n.jsx)(Z.Bw,{children:(0,n.jsxs)(Z.DI,{children:[(0,n.jsx)(Z.Ql,{value:"all",className:"text-xs",children:"All users"}),(0,n.jsx)(Z.Ql,{value:"verified",className:"text-xs",children:"Verified users"}),(0,n.jsx)(Z.Ql,{value:"unverified",className:"text-xs",children:"Unverified users"}),(0,n.jsx)(Z.Ql,{value:"anonymous",className:"text-xs",children:"Anonymous users"})]})})]}),(0,n.jsx)(_.E,{name:"Provider",options:ej,labelKey:"name",valueKey:"value",iconKey:"icon",activeOptions:et,labelClass:"text-xs",maxHeightClass:"h-[190px]",onSaveFilters:es}),(0,n.jsx)("div",{className:"border-r border-strong h-6"}),(0,n.jsx)(_.E,{name:0===$.length?"All columns":"Columns",title:"Select columns to show",buttonType:0===$.length?"dashed":"default",options:eb.slice(1),labelKey:"name",valueKey:"id",labelClass:"text-xs",maxHeightClass:"h-[190px]",clearButtonText:"Reset",activeOptions:$,onSaveFilters:e=>{let t=(null!=ef?ef:[]).slice();0===e.length?t=eb.map(e=>({id:e.id,width:e.width})):e.forEach(e=>{var s;t.find(t=>t.id===e)||t.push({id:e,width:null===(s=eb.find(t=>t.id===e))||void 0===s?void 0:s.width})});let s=(0,ew.Rs)({config:t,users:null!=eF?eF:[],visibleColumns:e,setSortByValue:er,onSelectDeleteUser:ec});ee(e),X(s),eH("toggle",{columns:s})}}),(0,n.jsxs)(M.h_,{children:[(0,n.jsx)(M.$F,{asChild:!0,children:(0,n.jsxs)(P.z,{icon:"desc"===eU?(0,n.jsx)(d.Z,{}):(0,n.jsx)(c.Z,{}),children:["Sorted by ",eC.replaceAll("_"," ")]})}),(0,n.jsx)(M.AW,{className:"w-44",align:"start",children:(0,n.jsxs)(M._x,{value:en,onValueChange:er,children:[(0,n.jsxs)(M.Ph,{children:[(0,n.jsx)(M.kt,{children:"Sort by created at"}),(0,n.jsxs)(M.TG,{children:[(0,n.jsx)(M.qB,{value:"created_at:asc",children:"Ascending"}),(0,n.jsx)(M.qB,{value:"created_at:desc",children:"Descending"})]})]}),(0,n.jsxs)(M.Ph,{children:[(0,n.jsx)(M.kt,{children:"Sort by last sign in at"}),(0,n.jsxs)(M.TG,{children:[(0,n.jsx)(M.qB,{value:"last_sign_in_at:asc",children:"Ascending"}),(0,n.jsx)(M.qB,{value:"last_sign_in_at:desc",children:"Descending"})]})]}),(0,n.jsxs)(M.Ph,{children:[(0,n.jsx)(M.kt,{children:"Sort by email"}),(0,n.jsxs)(M.TG,{children:[(0,n.jsx)(M.qB,{value:"email:asc",children:"Ascending"}),(0,n.jsx)(M.qB,{value:"email:desc",children:"Descending"})]})]}),(0,n.jsxs)(M.Ph,{children:[(0,n.jsx)(M.kt,{children:"Sort by phone"}),(0,n.jsxs)(M.TG,{children:[(0,n.jsx)(M.qB,{value:"phone:asc",children:"Ascending"}),(0,n.jsx)(M.qB,{value:"phone:desc",children:"Descending"})]})]})]})})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-x-2",children:[H&&(0,n.jsx)(w.Z,{section:["user-management"]}),(0,n.jsx)(P.z,{size:"tiny",icon:(0,n.jsx)(u.Z,{}),type:"default",loading:eL&&!ez,onClick:()=>eP(),children:"Refresh"}),(0,n.jsx)(ep,{})]})]})}),(0,n.jsx)(I.O,{loading:eT||eL||ez,"data-sentry-element":"LoadingLine","data-sentry-source-file":"UsersV2.tsx"}),(0,n.jsxs)(F.pO,{direction:"horizontal",className:"relative flex flex-grow bg-alternative min-h-0",autoSaveId:"query-performance-layout-v1","data-sentry-element":"ResizablePanelGroup","data-sentry-source-file":"UsersV2.tsx",children:[(0,n.jsx)(F.ee,{defaultSize:1,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"UsersV2.tsx",children:(0,n.jsx)("div",{className:"flex flex-col w-full h-full",children:(0,n.jsx)(f.ZP,{ref:A,className:"flex-grow border-t-0",rowHeight:44,headerRowHeight:36,columns:q,rows:(0,ew.Bi)(null!=eF?eF:[]),rowClass:e=>{let t=e.id===ea;return["".concat(t?"bg-surface-300 dark:bg-surface-300":"bg-200"," cursor-pointer"),"[&>.rdg-cell]:border-box [&>.rdg-cell]:outline-none [&>.rdg-cell]:shadow-none","[&>.rdg-cell:first-child>div]:ml-4"].join(" ")},rowKeyGetter:e=>e.id,selectedRows:el,onScroll:e=>{let t=D.current!==e.currentTarget.scrollLeft;D.current=e.currentTarget.scrollLeft,!eT&&!ez&&!t&&(0,ew.KG)(e)&&eZ&&eE()},onSelectedRowsChange:e=>{e.size>20?(0,p.Am)("Only up to ".concat(20," users can be selected at a time")):eo(e)},onColumnResize:(e,t)=>eH("resize",{idx:e,width:t}),onColumnsReorder:(e,t)=>{let s=q.findIndex(t=>t.key===e),n=q.findIndex(e=>e.key===t),r=eW(q,s,n);X(r),eH("reorder",{columns:r})},renderers:{renderRow:(e,t)=>(0,n.jsx)(f.X2,{...t,onClick:()=>{let s=eF.find(t=>t.id===e);if(s){let e=eF.indexOf(s);if(t.row.id){var n;ei(t.row.id),null===(n=A.current)||void 0===n||n.scrollToCell({idx:0,rowIdx:e})}}}}),noRowsFallback:eT?(0,n.jsx)("div",{className:"absolute top-14 px-6 w-full",children:(0,n.jsx)(W.A,{})}):eO?(0,n.jsx)("div",{className:"absolute top-14 px-6 flex flex-col items-center justify-center w-full",children:(0,n.jsx)(j.Z,{subject:"Failed to retrieve users",error:eA})}):(0,n.jsxs)("div",{className:"absolute top-20 px-6 flex flex-col items-center justify-center w-full gap-y-2",children:[(0,n.jsx)(m.Z,{className:"text-foreground-lighter",strokeWidth:1}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-foreground",children:"all"!==G||Y.length>0?"No users found":"No users in your project"}),(0,n.jsx)("p",{className:"text-foreground-light",children:"all"!==G||Y.length>0?"There are currently no users based on the filters applied":"There are currently no users who signed up to your project"})]})]})},"data-sentry-element":"DataGrid","data-sentry-source-file":"UsersV2.tsx"})})}),void 0!==ea&&(0,n.jsx)(eg.i,{selectedUser:eF.find(e=>e.id===ea),onClose:()=>ei(void 0)})]}),(0,n.jsxs)("div",{className:"flex justify-between min-h-9 h-9 overflow-hidden items-center px-6 w-full border-t text-xs text-foreground-light",children:[eT||eL?"Loading users...":"Total: ".concat(null!=eM?eM:0," users"),(eT||eL||ez)&&(0,n.jsxs)("span",{className:"flex items-center gap-2",children:[(0,n.jsx)(x.Z,{size:14,className:"animate-spin"})," Loading..."]})]})]}),(0,n.jsx)(B.Z,{visible:eu,variant:"destructive",title:"Confirm to delete ".concat(el.size," user").concat(el.size>1?"s":""),loading:ex,confirmLabel:"Delete",onCancel:()=>em(!1),onConfirm:()=>eq(),alert:{title:"Deleting ".concat(1===el.size?"a user":"users"," is irreversible"),description:"This will remove the selected ".concat(1===el.size?"":"".concat(el.size," "),"user").concat(el.size>1?"s":""," from the project and all associated data.")},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"UsersV2.tsx",children:(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:["This is permanent! Are you sure you want to delete the"," ",1===el.size?"":"selected ".concat(el.size," "),"user",el.size>1?"s":"",1===el.size?(0,n.jsxs)("span",{className:"text-foreground",children:[" ",null!==(t=null!==(e=null==eR?void 0:eR.email)&&void 0!==e?e:null==eR?void 0:eR.phone)&&void 0!==t?t:"this user"]}):null,"?"]})}),(0,n.jsx)(ev.T,{visible:!!ed,selectedUser:ed,onClose:()=>ec(void 0),onDeleteSuccess:()=>ec(void 0),"data-sentry-element":"DeleteUserModal","data-sentry-source-file":"UsersV2.tsx"})]})}},26233:function(e,t,s){var n=s(97458),r=s(10839),a=s(86186),i=s(90839);t.Z=e=>{let{section:t}=e,s=(0,a.WZ)();return(0,n.jsx)(i.z,{size:"tiny",type:"default",onClick:()=>{t&&s.setActiveDocsSection(t),s.setShowProjectApiDocs(!0)},icon:(0,n.jsx)(r.Z,{strokeWidth:1.5,className:"text-foreground-muted"}),"data-sentry-element":"Button","data-sentry-component":"APIDocsButton","data-sentry-source-file":"APIDocsButton.tsx",children:"API Docs"})}},66318:function(e,t,s){var n=s(97458),r=s(62507),a=s(57304),i=s(52983),l=s(45536),o=s(90839),d=s(65092);t.Z=e=>{var t;let{text:s,asyncText:c,iconOnly:u=!1,children:m,onClick:x,copyLabel:h="Copy",copiedLabel:f="Copied",...p}=e,[v,g]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{if(!v)return;let e=setTimeout(()=>g(!1),2e3);return()=>clearTimeout(e)},[v]),(0,n.jsx)(o.z,{onClick:async e=>{let t=c?await c():s;g(!0),await (0,l.vQ)(t),null==x||x(e)},...p,className:(0,d.cn)({"px-1":u},p.className),icon:v?(0,n.jsx)(r.Z,{strokeWidth:2,className:"text-brand"}):null!==(t=p.icon)&&void 0!==t?t:(0,n.jsx)(a.Z,{}),"data-sentry-element":"Button","data-sentry-component":"CopyButton","data-sentry-source-file":"CopyButton.tsx",children:!u&&(0,n.jsx)(n.Fragment,{children:null!=m?m:v?f:h})})}},96060:function(e,t,s){s.d(t,{E:function(){return u}});var n=s(97458),r=s(52983),a=s(42026),i=s(90839),l=s(65092),o=s(64890),d=s(61893),c=s(36155);let u=e=>{let{title:t,options:s=[],activeOptions:u=[],valueKey:m,labelKey:x,iconKey:h="icon",name:f="default",variant:p="rectangular",buttonType:v,disabled:g,labelClass:y,className:j,maxHeightClass:w="h-[205px]",clearButtonText:b="Clear",onSaveFilters:_}=e,[N,S]=(0,r.useState)(!1),[C,U]=(0,r.useState)([]),k=u.map(e=>{let t=s.find(t=>t[m]===e);return t&&t[x]?t[x]:""});return(0,r.useEffect)(()=>{!N&&u.length>0&&U(u)},[N,u]),(0,n.jsxs)(a.J2,{open:N,onOpenChange:S,"data-sentry-element":"Popover_Shadcn_","data-sentry-component":"FilterPopover","data-sentry-source-file":"FilterPopover.tsx",children:[(0,n.jsx)(a.xo,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"FilterPopover.tsx",children:(0,n.jsx)(i.z,{asChild:!0,disabled:g,type:null!=v?v:u.length>0?"default":"dashed",onClick:()=>S(!1),className:"rounded"===p?"rounded-full":"","data-sentry-element":"Button","data-sentry-source-file":"FilterPopover.tsx",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{children:f}),u.length>0&&(0,n.jsx)("span",{className:"mr-1",children:":"}),u.length>=3?(0,n.jsxs)("span",{children:[k[0]," and ",u.length-1," others"]}):u.length>0?(0,n.jsx)("span",{children:k.join(", ")}):null]})})}),(0,n.jsxs)(a.yk,{className:(0,l.cn)("p-0 w-44",j),align:"start","data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"FilterPopover.tsx",children:[(0,n.jsx)("div",{className:"border-b border-overlay bg-surface-200 rounded-t pb-1 px-3",children:(0,n.jsx)("span",{className:"text-xs text-foreground-light",children:null!=t?t:"Select ".concat(f.toLowerCase())})}),(0,n.jsx)(o.x,{className:s.length>7?w:"","data-sentry-element":"ScrollArea","data-sentry-source-file":"FilterPopover.tsx",children:(0,n.jsx)("div",{className:"p-3 flex flex-col gap-y-2",children:s.map(e=>{let t=e[m],s=h?e[h]:void 0;return(0,n.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,n.jsx)(d.X,{id:t,checked:C.includes(t),onCheckedChange:()=>{C.includes(t)?U(C.filter(e=>e!==t)):U(C.concat(t))}}),(0,n.jsxs)(c._,{htmlFor:e[m],className:(0,l.cn)("flex items-center gap-x-2 text-xs",y),children:[s&&(0,n.jsx)("img",{src:s,alt:e[x],className:(0,l.cn)("w-4 h-4",e.iconClass)}),(0,n.jsx)("span",{children:e[x]})]})]},t)})})}),(0,n.jsxs)("div",{className:"flex items-center justify-end gap-2 border-t border-overlay bg-surface-200 py-2 px-3",children:[(0,n.jsx)(i.z,{size:"tiny",type:"default",onClick:()=>{_([]),U([]),S(!1)},"data-sentry-element":"Button","data-sentry-source-file":"FilterPopover.tsx",children:b}),(0,n.jsx)(i.z,{type:"primary",onClick:()=>{let e=s.map(e=>e[m]);_(C.sort((t,s)=>e.indexOf(t)-e.indexOf(s))),S(!1)},"data-sentry-element":"Button","data-sentry-source-file":"FilterPopover.tsx",children:"Save"})]})]})]})}},57703:function(e,t,s){s.d(t,{Z:function(){return h}});var n=s(90688),r=s(28894),a=s(28977),i=s.n(a),l=s(52983),o=s(89831),d=s(90876),c=s(6464),u=s(25024),m=s(96770),x=(e,t)=>(0,l.useMemo)(()=>0!==e.length&&(0,d.Sj)(e[0][t])?null==e?void 0:e.map(e=>(e[t]=(0,d.tI)(e[t]),e)):e,[JSON.stringify(e)]),h=function(e){var t,s,a,h;let{projectRef:f,table:p,filterOverride:v,limit:g}=e,y=(0,o.PJ)(o.bj),[j,w]=(0,l.useState)(new Date().toISOString()),b=(0,l.useRef)(!0),{timestampStart:_=y.calcFrom(),timestampEnd:N=y.calcTo(),filters:S,search:C}=(0,u.k)(),U=_||y.calcFrom(),k=N||y.calcTo(),A=(0,l.useMemo)(()=>({...S,...v,...C?{search_query:C}:{}}),[S,v,C]),[D,T]=(0,l.useState)((0,d.UR)(p,A,g)),L={project:f,iso_timestamp_start:U,iso_timestamp_end:k,sql:D},{data:O,isSuccess:z,isLoading:P,isRefetching:Z,error:E,fetchNextPage:M,isFetchingNextPage:I,refetch:F}=(0,n.N)(["projects",f,"logs",L],async e=>{let{signal:t,pageParam:s}=e,{data:n,error:r}=await (0,c.U2)("/platform/projects/{ref}/analytics/endpoints/logs.all",{params:{path:{ref:f},query:{...L,iso_timestamp_end:s||L.iso_timestamp_end}},signal:t});if(r)throw r;return n},{refetchOnWindowFocus:!1,getNextPageParam(e){var t,s;if((null!==(s=null===(t=e.result)||void 0===t?void 0:t.length)&&void 0!==s?s:0)===0)return;let n=e.result.length,{timestamp:r}=e.result[n-1];return i().utc(Number(r/1e3)).toISOString()}});(0,l.useEffect)(()=>{if(b.current){b.current=!1;return}let e=(0,d.UR)(p,A,g);T(e),G(e)},[JSON.stringify(A)]);let{logData:R,error:B,oldestTimestamp:W}=(0,l.useMemo)(()=>{var e;let t=[],s=E?E.message:null;null==O||O.pages.forEach(e=>{e.result&&(t=[...t,...e.result]),!s&&e&&e.error&&(s=e.error)});let n=null===(e=t[t.length-1])||void 0===e?void 0:e.timestamp;return{logData:t,error:s,oldestTimestamp:n}},[null==O?void 0:O.pages]),{data:H}=(0,r.a)(["projects",f,"logs-count",{...L,sql:(0,d.My)(p,A),timestampStart:U,latestRefresh:j}],async e=>{let{signal:t}=e,{data:s,error:n}=await (0,c.U2)("/platform/projects/{ref}/analytics/endpoints/logs.all",{params:{path:{ref:f},query:{...L,sql:(0,d.My)(p,A),iso_timestamp_start:j}},signal:t});if(n)throw n;return s},{refetchOnWindowFocus:!1,refetchInterval:6e4,enabled:!B&&!!O&&O.pages.length>0});console.log("countData",H);let q=null!==(a=null==H?void 0:null===(s=H.result)||void 0===s?void 0:null===(t=s[0])||void 0===t?void 0:t.count)&&void 0!==a?a:0,X=(0,l.useMemo)(()=>(0,d.g8)(p,L,A),[p,L.iso_timestamp_end,L.project,A]),{data:V,refetch:K}=(0,r.a)(["projects",f,"logs-chart",{iso_timestamp_end:L.iso_timestamp_end,project:L.project,sql:X}],async e=>{var t,s,n;let{signal:r}=e,{data:a,error:i}=await (0,c.U2)("/platform/projects/{ref}/analytics/endpoints/logs.all",{params:{path:{ref:f},query:{iso_timestamp_start:null!==(t=L.iso_timestamp_start)&&void 0!==t?t:"",iso_timestamp_end:null!==(s=L.iso_timestamp_end)&&void 0!==s?s:"",project:null!==(n=L.project)&&void 0!==n?n:"",sql:X}},signal:r});if(i)throw i;return a},{refetchOnWindowFocus:!1}),G=async e=>{T(e||(0,d.UR)(p,A,g)),K(),w(new Date().toISOString()),F()};(0,l.useEffect)(()=>{L.iso_timestamp_start=U,L.iso_timestamp_end=k},[U,k]);let Q=x(null!==(h=null==V?void 0:V.result)&&void 0!==h?h:[],"timestamp"),{data:Y,error:J}=(0,m.Z)(Q,"timestamp","count",0,L.iso_timestamp_start,L.iso_timestamp_end||new Date().toISOString());return{newCount:q,logData:R,isSuccess:z,isLoading:P||Z,isLoadingOlder:I,error:B||J,filters:A,params:L,oldestTimestamp:W?String(W):void 0,eventChartData:Y,refresh:G,loadOlder:()=>M()}}},27246:function(e,t,s){s.d(t,{O:function(){return a}});var n=s(97458),r=s(65092);let a=e=>{let{loading:t}=e;return(0,n.jsx)("div",{className:"relative overflow-hidden w-full h-px bg-border m-auto","data-sentry-component":"LoadingLine","data-sentry-source-file":"LoadingLine.tsx",children:(0,n.jsx)("span",{className:(0,r.cn)("absolute w-[80px] h-px ml-auto mr-auto left-0 right-0 text-center block top-0","transition-all","line-loading-bg-light dark:line-loading-bg",t&&"animate-line-loading-slower opacity-100",t?"opacity-100":"opacity-0")})})}}}]);