!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="6234c6bc-653d-45ee-ab7e-6ca0ef2754fc",e._sentryDebugIdIdentifier="sentry-dbid-6234c6bc-653d-45ee-ab7e-6ca0ef2754fc")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6739],{65858:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});let o=(0,r(98266).Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},90318:function(e,t,r){"use strict";var o=r(15313).Buffer;let a=void 0!==o,n=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,l=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function s(e,t,r){null==r&&null!==t&&"object"==typeof t&&(r=t,t=void 0),a&&o.isBuffer(e)&&(e=e.toString()),e&&65279===e.charCodeAt(0)&&(e=e.slice(1));let s=JSON.parse(e,t);if(null===s||"object"!=typeof s)return s;let c=r&&r.protoAction||"error",u=r&&r.constructorAction||"error";if("ignore"===c&&"ignore"===u)return s;if("ignore"!==c&&"ignore"!==u){if(!1===n.test(e)&&!1===l.test(e))return s}else if("ignore"!==c&&"ignore"===u){if(!1===n.test(e))return s}else if(!1===l.test(e))return s;return i(s,{protoAction:c,constructorAction:u,safe:r&&r.safe})}function i(e,{protoAction:t="error",constructorAction:r="error",safe:o}={}){let a=[e];for(;a.length;){let e=a;for(let n of(a=[],e)){if("ignore"!==t&&Object.prototype.hasOwnProperty.call(n,"__proto__")){if(!0===o)return null;if("error"===t)throw SyntaxError("Object contains forbidden prototype property");delete n.__proto__}if("ignore"!==r&&Object.prototype.hasOwnProperty.call(n,"constructor")&&Object.prototype.hasOwnProperty.call(n.constructor,"prototype")){if(!0===o)return null;if("error"===r)throw SyntaxError("Object contains forbidden prototype property");delete n.constructor}for(let e in n){let t=n[e];t&&"object"==typeof t&&a.push(t)}}}return e}function c(e,t,r){let o=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return s(e,t,r)}finally{Error.stackTraceLimit=o}}e.exports=c,e.exports.default=c,e.exports.parse=c,e.exports.safeParse=function(e,t){let r=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return s(e,t,{safe:!0})}catch(e){return null}finally{Error.stackTraceLimit=r}},e.exports.scan=i},32631:function(e){e.exports=function(e,t){let r;if("function"!=typeof e)throw TypeError(`Expected the first argument to be a \`function\`, got \`${typeof e}\`.`);let o=0;return function(...a){clearTimeout(r);let n=Date.now(),l=t-(n-o);l<=0?(o=n,e.apply(this,a)):r=setTimeout(()=>{o=Date.now(),e.apply(this,a)},l)}}},42019:function(e,t,r){"use strict";let o;r.d(t,{RJ:function(){return ez},GO:function(){return eZ}});var a,n,l=r(52983),s="vercel.ai.error",i=Symbol.for(s),c=class e extends Error{constructor({name:e,message:t,cause:r}){super(t),this[a]=!0,this.name=e,this.cause=r}static isInstance(t){return e.hasMarker(t,s)}static hasMarker(e,t){let r=Symbol.for(t);return null!=e&&"object"==typeof e&&r in e&&"boolean"==typeof e[r]&&!0===e[r]}toJSON(){return{name:this.name,message:this.message}}};a=i;var u=c,d=(Symbol.for("vercel.ai.error.AI_APICallError"),Symbol.for("vercel.ai.error.AI_EmptyResponseBodyError"),"AI_InvalidArgumentError"),f=`vercel.ai.error.${d}`,p=Symbol.for(f),_=class extends u{constructor({message:e,cause:t,argument:r}){super({name:d,message:e,cause:t}),this[n]=!0,this.argument=r}static isInstance(e){return u.hasMarker(e,f)}};n=p,Symbol.for("vercel.ai.error.AI_InvalidPromptError"),Symbol.for("vercel.ai.error.AI_InvalidResponseDataError"),Symbol.for("vercel.ai.error.AI_JSONParseError"),Symbol.for("vercel.ai.error.AI_LoadAPIKeyError"),Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError"),Symbol.for("vercel.ai.error.AI_NoSuchModelError"),Symbol.for("vercel.ai.error.AI_TooManyEmbeddingValuesForCallError"),Symbol.for("vercel.ai.error.AI_TypeValidationError"),Symbol.for("vercel.ai.error.AI_UnsupportedFunctionalityError");let h=(e,t=21)=>(r=t)=>{let o="",a=0|r;for(;a--;)o+=e[Math.random()*e.length|0];return o};var g=r(90318);r(73656);var y=(({prefix:e,size:t=7,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:o="-"}={})=>{let a=h(r,t);if(null==e)return a;if(r.includes(o))throw new _({argument:"separator",message:`The separator "${o}" must not be part of the alphabet "${r}".`});return t=>`${e}${o}${a(t)}`})();Symbol.for("vercel.ai.validator");var{btoa:m,atob:E}=globalThis;Symbol("Let zodToJsonSchema decide on which parser to use");let b=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")};var I={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},v={code:"1",name:"function_call",parse:e=>{if(null==e||"object"!=typeof e||!("function_call"in e)||"object"!=typeof e.function_call||null==e.function_call||!("name"in e.function_call)||!("arguments"in e.function_call)||"string"!=typeof e.function_call.name||"string"!=typeof e.function_call.arguments)throw Error('"function_call" parts expect an object with a "function_call" property.');return{type:"function_call",value:e}}},w={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw Error('"data" parts expect an array value.');return{type:"data",value:e}}},T={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},A={code:"4",name:"assistant_message",parse:e=>{if(null==e||"object"!=typeof e||!("id"in e)||!("role"in e)||!("content"in e)||"string"!=typeof e.id||"string"!=typeof e.role||"assistant"!==e.role||!Array.isArray(e.content)||!e.content.every(e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},R={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},S={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},k={code:"7",name:"tool_calls",parse:e=>{if(null==e||"object"!=typeof e||!("tool_calls"in e)||"object"!=typeof e.tool_calls||null==e.tool_calls||!Array.isArray(e.tool_calls)||e.tool_calls.some(e=>null==e||"object"!=typeof e||!("id"in e)||"string"!=typeof e.id||!("type"in e)||"string"!=typeof e.type||!("function"in e)||null==e.function||"object"!=typeof e.function||!("arguments"in e.function)||"string"!=typeof e.function.name||"string"!=typeof e.function.arguments))throw Error('"tool_calls" parts expect an object with a ToolCallPayload.');return{type:"tool_calls",value:e}}},N={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},C={code:"9",name:"tool_call",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName||!("args"in e)||"object"!=typeof e.args)throw Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},x={code:"a",name:"tool_result",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("result"in e))throw Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},D={code:"b",name:"tool_call_streaming_start",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName)throw Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},O={code:"c",name:"tool_call_delta",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("argsTextDelta"in e)||"string"!=typeof e.argsTextDelta)throw Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},F={code:"d",name:"finish_message",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_message" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},L={code:"e",name:"finish_step",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_step" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&"boolean"==typeof e.isContinued&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},j={[I.code]:I,[v.code]:v,[w.code]:w,[T.code]:T,[A.code]:A,[R.code]:R,[S.code]:S,[k.code]:k,[N.code]:N,[C.code]:C,[x.code]:x,[D.code]:D,[O.code]:O,[F.code]:F,[L.code]:L};I.name,I.code,v.name,v.code,w.name,w.code,T.name,T.code,A.name,A.code,R.name,R.code,S.name,S.code,k.name,k.code,N.name,N.code,C.name,C.code,x.name,x.code,D.name,D.code,O.name,O.code,F.name,F.code,L.name,L.code;var V=[I,v,w,T,A,R,S,k,N,C,x,D,O,F,L].map(e=>e.code),M=e=>{let t=e.indexOf(":");if(-1===t)throw Error("Failed to parse stream string. No separator found.");let r=e.slice(0,t);if(!V.includes(r))throw Error(`Failed to parse stream string. Invalid code ${r}.`);let o=JSON.parse(e.slice(t+1));return j[r].parse(o)};async function*B(e,{isAborted:t}={}){let r=new TextDecoder,o=[],a=0;for(;;){let{value:n}=await e.read();if(n&&(o.push(n),a+=n.length,10!==n[n.length-1]))continue;if(0===o.length)break;let l=function(e,t){let r=new Uint8Array(t),o=0;for(let t of e)r.set(t,o),o+=t.length;return e.length=0,r}(o,a);for(let e of(a=0,r.decode(l,{stream:!0}).split("\n").filter(e=>""!==e).map(M)))yield e;if(null==t?void 0:t()){e.cancel();break}}}function J(e,t){return e&&t&&t.length?{...e,annotations:[...t]}:e}async function U({reader:e,abortControllerRef:t,update:r,onToolCall:o,onFinish:a,generateId:n=y,getCurrentDate:l=()=>new Date}){var s;let i,c;let u=l(),d={},f=[],p=[],_={},h={completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},m="unknown";for await(let{type:a,value:l}of B(e,{isAborted:()=>(null==t?void 0:t.current)===null})){if("error"===a)throw Error(l);if("finish_step"===a){l.isContinued||(i={});continue}if("finish_message"===a){if(m=l.finishReason,null!=l.usage){let{completionTokens:e,promptTokens:t}=l.usage;h={completionTokens:e,promptTokens:t,totalTokens:e+t}}continue}if(null!=i&&("text"===a||"tool_call"===a||"tool_call_streaming_start"===a||"tool_call_delta"===a||"tool_result"===a)&&(d.text&&f.push(d.text),d.function_call&&f.push(d.function_call),d.tool_calls&&f.push(d.tool_calls),d=i,i=void 0),"text"===a&&(d.text?d.text={...d.text,content:(d.text.content||"")+l}:d.text={id:n(),role:"assistant",content:l,createdAt:u}),"tool_call_streaming_start"===a)null==d.text&&(d.text={id:n(),role:"assistant",content:"",createdAt:u}),null==d.text.toolInvocations&&(d.text.toolInvocations=[]),_[l.toolCallId]={text:"",toolName:l.toolName,prefixMapIndex:d.text.toolInvocations.length},d.text.toolInvocations.push({state:"partial-call",toolCallId:l.toolCallId,toolName:l.toolName,args:void 0});else if("tool_call_delta"===a){let e=_[l.toolCallId];e.text+=l.argsTextDelta;let{value:t}=function(e){if(void 0===e)return{value:void 0,state:"undefined-input"};try{return{value:g.parse(e),state:"successful-parse"}}catch(t){try{return{value:g.parse(function(e){let t=["ROOT"],r=-1,o=null;function a(e,a,n){switch(e){case'"':r=a,t.pop(),t.push(n),t.push("INSIDE_STRING");break;case"f":case"t":case"n":r=a,o=a,t.pop(),t.push(n),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(n),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=a,t.pop(),t.push(n),t.push("INSIDE_NUMBER");break;case"{":r=a,t.pop(),t.push(n),t.push("INSIDE_OBJECT_START");break;case"[":r=a,t.pop(),t.push(n),t.push("INSIDE_ARRAY_START")}}function n(e,o){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":r=o,t.pop()}}function l(e,o){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=o,t.pop()}}for(let s=0;s<e.length;s++){let i=e[s];switch(t[t.length-1]){case"ROOT":a(i,s,"FINISH");break;case"INSIDE_OBJECT_START":switch(i){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":r=s,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===i&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===i&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===i&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":a(i,s,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":n(i,s);break;case"INSIDE_STRING":switch(i){case'"':t.pop(),r=s;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:r=s}break;case"INSIDE_ARRAY_START":"]"===i?(r=s,t.pop()):(r=s,a(i,s,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(i){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=s,t.pop();break;default:r=s}break;case"INSIDE_ARRAY_AFTER_COMMA":a(i,s,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),r=s;break;case"INSIDE_NUMBER":switch(i){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=s;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&l(i,s),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&n(i,s);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&n(i,s);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&l(i,s);break;default:t.pop()}break;case"INSIDE_LITERAL":{let a=e.substring(o,s+1);"false".startsWith(a)||"true".startsWith(a)||"null".startsWith(a)?r=s:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?n(i,s):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&l(i,s))}}}let s=e.slice(0,r+1);for(let r=t.length-1;r>=0;r--)switch(t[r]){case"INSIDE_STRING":s+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":s+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":s+="]";break;case"INSIDE_LITERAL":{let t=e.substring(o,e.length);"true".startsWith(t)?s+="true".slice(t.length):"false".startsWith(t)?s+="false".slice(t.length):"null".startsWith(t)&&(s+="null".slice(t.length))}}return s}(e)),state:"repaired-parse"}}catch(e){}}return{value:void 0,state:"failed-parse"}}(e.text);d.text.toolInvocations[e.prefixMapIndex]={state:"partial-call",toolCallId:l.toolCallId,toolName:e.toolName,args:t},d.text.internalUpdateId=n()}else if("tool_call"===a){if(null!=_[l.toolCallId]?d.text.toolInvocations[_[l.toolCallId].prefixMapIndex]={state:"call",...l}:(null==d.text&&(d.text={id:n(),role:"assistant",content:"",createdAt:u}),null==d.text.toolInvocations&&(d.text.toolInvocations=[]),d.text.toolInvocations.push({state:"call",...l})),d.text.internalUpdateId=n(),o){let e=await o({toolCall:l});null!=e&&(d.text.toolInvocations[d.text.toolInvocations.length-1]={state:"result",...l,result:e})}}else if("tool_result"===a){let e=null==(s=d.text)?void 0:s.toolInvocations;if(null==e)throw Error("tool_result must be preceded by a tool_call");let t=e.findIndex(e=>e.toolCallId===l.toolCallId);if(-1===t)throw Error("tool_result must be preceded by a tool_call with the same toolCallId");e[t]={...e[t],state:"result",...l}}let e=null;"function_call"===a&&(d.function_call={id:n(),role:"assistant",content:"",function_call:l.function_call,name:l.function_call.name,createdAt:u},e=d.function_call);let t=null;"tool_calls"===a&&(d.tool_calls={id:n(),role:"assistant",content:"",tool_calls:l.tool_calls,createdAt:u},t=d.tool_calls),"data"===a&&p.push(...l);let y=d.text;"message_annotations"===a&&(c?c.push(...l):c=[...l],e=J(d.function_call,c),t=J(d.tool_calls,c),y=J(d.text,c),null!=d.text&&(d.text.internalUpdateId=n())),(null==c?void 0:c.length)&&(d.text&&(d.text.annotations=[...c]),d.function_call&&(d.function_call.annotations=[...c]),d.tool_calls&&(d.tool_calls.annotations=[...c])),r([...f,...[e,t,y].filter(Boolean).map(e=>({...J(e,c)}))],[...p])}return null==a||a({message:d.text,finishReason:m,usage:h}),{messages:[d.text,d.function_call,d.tool_calls].filter(Boolean),data:p}}var P=()=>fetch;async function Y({api:e,body:t,streamProtocol:r="data",credentials:o,headers:a,abortController:n,restoreMessagesOnFailure:l,onResponse:s,onUpdate:i,onFinish:c,onToolCall:u,generateId:d,fetch:f=P()}){var p,_;let h=await f(e,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",...a},signal:null==(p=null==n?void 0:n())?void 0:p.signal,credentials:o}).catch(e=>{throw l(),e});if(s)try{await s(h)}catch(e){throw e}if(!h.ok)throw l(),Error(null!=(_=await h.text())?_:"Failed to fetch the chat response.");if(!h.body)throw Error("The response body is empty.");let g=h.body.getReader();switch(r){case"text":{let e=K(),t={id:d(),createdAt:new Date,role:"assistant",content:""};for(;;){let{done:r,value:o}=await g.read();if(r)break;if(t.content+=e(o),i([{...t}],[]),(null==n?void 0:n())===null){g.cancel();break}}return null==c||c(t,{usage:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},finishReason:"unknown"}),{messages:[t],data:[]}}case"data":return await U({reader:g,abortControllerRef:null!=n?{current:n()}:void 0,update:i,onToolCall:u,onFinish({message:e,finishReason:t,usage:r}){c&&null!=e&&c(e,{usage:r,finishReason:t})},generateId:d});default:throw Error(`Unknown stream protocol: ${r}`)}}var $=()=>fetch;async function W({api:e,prompt:t,credentials:r,headers:o,body:a,streamProtocol:n="data",setCompletion:l,setLoading:s,setError:i,setAbortController:c,onResponse:u,onFinish:d,onError:f,onData:p,fetch:_=$()}){try{s(!0),i(void 0);let f=new AbortController;c(f),l("");let h=await _(e,{method:"POST",body:JSON.stringify({prompt:t,...a}),credentials:r,headers:{"Content-Type":"application/json",...o},signal:f.signal}).catch(e=>{throw e});if(u)try{await u(h)}catch(e){throw e}if(!h.ok)throw Error(await h.text()||"Failed to fetch the chat response.");if(!h.body)throw Error("The response body is empty.");let g="",y=h.body.getReader();switch(n){case"text":{let e=K();for(;;){let{done:t,value:r}=await y.read();if(t)break;if(g+=e(r),l(g),null===f){y.cancel();break}}break}case"data":for await(let{type:e,value:t}of B(y,{isAborted:()=>null===f}))switch(e){case"text":g+=t,l(g);break;case"data":null==p||p(t)}break;default:throw Error(`Unknown stream protocol: ${n}`)}return d&&d(t,g),c(null),g}catch(e){if("AbortError"===e.name)return c(null),null;e instanceof Error&&f&&f(e),i(e)}finally{s(!1)}}function K(e){let t=new TextDecoder;return e?function(e){return t.decode(e,{stream:!0}).split("\n").filter(e=>""!==e).map(M).filter(Boolean)}:function(e){return e?t.decode(e,{stream:!0}):""}}async function q({getStreamedResponse:e,experimental_onFunctionCall:t,experimental_onToolCall:r,updateChatRequest:o,getCurrentMessages:a}){for(;;){let n=await e();if("messages"in n){let e=!1;for(let l of n.messages)if(void 0!==l.function_call&&"string"!=typeof l.function_call||void 0!==l.tool_calls&&"string"!=typeof l.tool_calls){if(e=!0,t){let r=l.function_call;if("object"!=typeof r){console.warn("experimental_onFunctionCall should not be defined when using tools");continue}let n=await t(a(),r);if(void 0===n){e=!1;break}o(n)}if(r){let t=l.tool_calls;if(!Array.isArray(t)||t.some(e=>"object"!=typeof e)){console.warn("experimental_onToolCall should not be defined when using tools");continue}let n=await r(a(),t);if(void 0===n){e=!1;break}o(n)}}if(!e)break}else{let e=function(e){for(let t of e.messages){if(void 0!==t.tool_calls)for(let e of t.tool_calls)"object"==typeof e&&e.function.arguments&&"string"!=typeof e.function.arguments&&(e.function.arguments=JSON.stringify(e.function.arguments));void 0!==t.function_call&&"object"==typeof t.function_call&&t.function_call.arguments&&"string"!=typeof t.function_call.arguments&&(t.function_call.arguments=JSON.stringify(t.function_call.arguments))}};if((void 0===n.function_call||"string"==typeof n.function_call)&&(void 0===n.tool_calls||"string"==typeof n.tool_calls))break;if(t){let r=n.function_call;if("object"!=typeof r){console.warn("experimental_onFunctionCall should not be defined when using tools");continue}let l=await t(a(),r);if(void 0===l)break;e(l),o(l)}if(r){let t=n.tool_calls;if("object"!=typeof t){console.warn("experimental_onToolCall should not be defined when using functions");continue}let l=await r(a(),t);if(void 0===l)break;e(l),o(l)}}}}Symbol.for("vercel.ai.schema");var G=r(83576);let z=()=>{},Z=z(),H=Object,Q=e=>e===Z,X=e=>"function"==typeof e,ee=(e,t)=>({...e,...t}),et=e=>X(e.then),er=new WeakMap,eo=0,ea=e=>{let t,r;let o=typeof e,a=e&&e.constructor,n=a==Date;if(H(e)!==e||n||a==RegExp)t=n?e.toJSON():"symbol"==o?e.toString():"string"==o?JSON.stringify(e):""+e;else{if(t=er.get(e))return t;if(t=++eo+"~",er.set(e,t),a==Array){for(r=0,t="@";r<e.length;r++)t+=ea(e[r])+",";er.set(e,t)}if(a==H){t="#";let o=H.keys(e).sort();for(;!Q(r=o.pop());)Q(e[r])||(t+=r+":"+ea(e[r])+",");er.set(e,t)}}return t},en=new WeakMap,el={},es={},ei="undefined",ec=typeof window!=ei,eu=typeof document!=ei,ed=()=>ec&&typeof window.requestAnimationFrame!=ei,ef=(e,t)=>{let r=en.get(e);return[()=>!Q(t)&&e.get(t)||el,o=>{if(!Q(t)){let a=e.get(t);t in es||(es[t]=a),r[5](t,ee(a,o),a||el)}},r[6],()=>!Q(t)&&t in es?es[t]:!Q(t)&&e.get(t)||el]},ep=!0,[e_,eh]=ec&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[z,z],eg={initFocus:e=>(eu&&document.addEventListener("visibilitychange",e),e_("focus",e),()=>{eu&&document.removeEventListener("visibilitychange",e),eh("focus",e)}),initReconnect:e=>{let t=()=>{ep=!0,e()},r=()=>{ep=!1};return e_("online",t),e_("offline",r),()=>{eh("online",t),eh("offline",r)}}},ey=!l.useId,em=!ec||"Deno"in window,eE=e=>ed()?window.requestAnimationFrame(e):setTimeout(e,1),eb=em?l.useEffect:l.useLayoutEffect,eI="undefined"!=typeof navigator&&navigator.connection,ev=!em&&eI&&(["slow-2g","2g"].includes(eI.effectiveType)||eI.saveData),ew=e=>{if(X(e))try{e=e()}catch(t){e=""}let t=e;return[e="string"==typeof e?e:(Array.isArray(e)?e.length:e)?ea(e):"",t]},eT=0,eA=()=>++eT;var eR={ERROR_REVALIDATE_EVENT:3,FOCUS_EVENT:0,MUTATE_EVENT:2,RECONNECT_EVENT:1};async function eS(...e){let[t,r,o,a]=e,n=ee({populateCache:!0,throwOnError:!0},"boolean"==typeof a?{revalidate:a}:a||{}),l=n.populateCache,s=n.rollbackOnError,i=n.optimisticData,c=e=>"function"==typeof s?s(e):!1!==s,u=n.throwOnError;if(X(r)){let e=[];for(let o of t.keys())!/^\$(inf|sub)\$/.test(o)&&r(t.get(o)._k)&&e.push(o);return Promise.all(e.map(d))}return d(r);async function d(r){let a;let[s]=ew(r);if(!s)return;let[d,f]=ef(t,s),[p,_,h,g]=en.get(t),y=()=>{let e=p[s];return(X(n.revalidate)?n.revalidate(d().data,r):!1!==n.revalidate)&&(delete h[s],delete g[s],e&&e[0])?e[0](2).then(()=>d().data):d().data};if(e.length<3)return y();let m=o,E=eA();_[s]=[E,0];let b=!Q(i),I=d(),v=I.data,w=I._c,T=Q(w)?v:w;if(b&&f({data:i=X(i)?i(T,v):i,_c:T}),X(m))try{m=m(T)}catch(e){a=e}if(m&&et(m)){if(m=await m.catch(e=>{a=e}),E!==_[s][0]){if(a)throw a;return m}a&&b&&c(a)&&(l=!0,f({data:T,_c:Z}))}if(l&&!a&&(X(l)?f({data:l(m,T),error:Z,_c:Z}):f({data:m,error:Z,_c:Z})),_[s][1]=eA(),Promise.resolve(y()).then(()=>{f({_c:Z})}),a){if(u)throw a;return}return m}}let ek=(e,t)=>{for(let r in e)e[r][0]&&e[r][0](t)},eN=(e,t)=>{if(!en.has(e)){let r=ee(eg,t),o={},a=eS.bind(Z,e),n=z,l={},s=(e,t)=>{let r=l[e]||[];return l[e]=r,r.push(t),()=>r.splice(r.indexOf(t),1)},i=(t,r,o)=>{e.set(t,r);let a=l[t];if(a)for(let e of a)e(r,o)},c=()=>{if(!en.has(e)&&(en.set(e,[o,{},{},{},a,i,s]),!em)){let t=r.initFocus(setTimeout.bind(Z,ek.bind(Z,o,0))),a=r.initReconnect(setTimeout.bind(Z,ek.bind(Z,o,1)));n=()=>{t&&t(),a&&a(),en.delete(e)}}};return c(),[e,a,c,n]}return[e,en.get(e)[4]]},[eC,ex]=eN(new Map),eD=ee({onLoadingSlow:z,onSuccess:z,onError:z,onErrorRetry:(e,t,r,o,a)=>{let n=r.errorRetryCount,l=a.retryCount,s=~~((Math.random()+.5)*(1<<(l<8?l:8)))*r.errorRetryInterval;(Q(n)||!(l>n))&&setTimeout(o,s,a)},onDiscarded:z,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:ev?1e4:5e3,focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:ev?5e3:3e3,compare:(e,t)=>ea(e)==ea(t),isPaused:()=>!1,cache:eC,mutate:ex,fallback:{}},{isOnline:()=>ep,isVisible:()=>{let e=eu&&document.visibilityState;return Q(e)||"hidden"!==e}}),eO=(e,t)=>{let r=ee(e,t);if(t){let{use:o,fallback:a}=e,{use:n,fallback:l}=t;o&&n&&(r.use=o.concat(n)),a&&l&&(r.fallback=ee(a,l))}return r},eF=(0,l.createContext)({}),eL=ec&&window.__SWR_DEVTOOLS_USE__,ej=eL?window.__SWR_DEVTOOLS_USE__:[],eV=e=>X(e[1])?[e[0],e[1],e[2]||{}]:[e[0],null,(null===e[1]?e[2]:e[1])||{}],eM=()=>ee(eD,(0,l.useContext)(eF)),eB=ej.concat(e=>(t,r,o)=>{let a=r&&((...e)=>{let[o]=ew(t),[,,,a]=en.get(eC);if(o.startsWith("$inf$"))return r(...e);let n=a[o];return Q(n)?r(...e):(delete a[o],n)});return e(t,a,o)}),eJ=(e,t,r)=>{let o=t[e]||(t[e]=[]);return o.push(r),()=>{let e=o.indexOf(r);e>=0&&(o[e]=o[o.length-1],o.pop())}};eL&&(window.__SWR_DEVTOOLS_REACT__=l);let eU=l.use||(e=>{if("pending"===e.status)throw e;if("fulfilled"===e.status)return e.value;if("rejected"===e.status)throw e.reason;throw e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}),e}),eP={dedupe:!0};H.defineProperty(e=>{let{value:t}=e,r=(0,l.useContext)(eF),o=X(t),a=(0,l.useMemo)(()=>o?t(r):t,[o,r,t]),n=(0,l.useMemo)(()=>o?a:eO(r,a),[o,r,a]),s=a&&a.provider,i=(0,l.useRef)(Z);s&&!i.current&&(i.current=eN(s(n.cache||eC),a));let c=i.current;return c&&(n.cache=c[0],n.mutate=c[1]),eb(()=>{if(c)return c[2]&&c[2](),c[3]},[]),(0,l.createElement)(eF.Provider,ee(e,{value:n}))},"defaultValue",{value:eD});let eY=(o=(e,t,r)=>{let{cache:o,compare:a,suspense:n,fallbackData:s,revalidateOnMount:i,revalidateIfStale:c,refreshInterval:u,refreshWhenHidden:d,refreshWhenOffline:f,keepPreviousData:p}=r,[_,h,g,y]=en.get(o),[m,E]=ew(e),b=(0,l.useRef)(!1),I=(0,l.useRef)(!1),v=(0,l.useRef)(m),w=(0,l.useRef)(t),T=(0,l.useRef)(r),A=()=>T.current,R=()=>A().isVisible()&&A().isOnline(),[S,k,N,C]=ef(o,m),x=(0,l.useRef)({}).current,D=Q(s)?r.fallback[m]:s,O=(e,t)=>{for(let r in x)if("data"===r){if(!a(e[r],t[r])&&(!Q(e[r])||!a(P,t[r])))return!1}else if(t[r]!==e[r])return!1;return!0},F=(0,l.useMemo)(()=>{let e=!!m&&!!t&&(Q(i)?!A().isPaused()&&!n&&(!!Q(c)||c):i),r=t=>{let r=ee(t);return(delete r._k,e)?{isValidating:!0,isLoading:!0,...r}:r},o=S(),a=C(),l=r(o),s=o===a?l:r(a),u=l;return[()=>{let e=r(S());return O(e,u)?(u.data=e.data,u.isLoading=e.isLoading,u.isValidating=e.isValidating,u.error=e.error,u):(u=e,e)},()=>s]},[o,m]),L=(0,G.useSyncExternalStore)((0,l.useCallback)(e=>N(m,(t,r)=>{O(r,t)||e()}),[o,m]),F[0],F[1]),j=!b.current,V=_[m]&&_[m].length>0,M=L.data,B=Q(M)?D:M,J=L.error,U=(0,l.useRef)(B),P=p?Q(M)?U.current:M:B,Y=(!V||!!Q(J))&&(j&&!Q(i)?i:!A().isPaused()&&(n?!Q(B)&&c:Q(B)||c)),$=!!(m&&t&&j&&Y),W=Q(L.isValidating)?$:L.isValidating,K=Q(L.isLoading)?$:L.isLoading,q=(0,l.useCallback)(async e=>{let t,o;let n=w.current;if(!m||!n||I.current||A().isPaused())return!1;let l=!0,s=e||{},i=!g[m]||!s.dedupe,c=()=>ey?!I.current&&m===v.current&&b.current:m===v.current,u={isValidating:!1,isLoading:!1},d=()=>{k(u)},f=()=>{let e=g[m];e&&e[1]===o&&delete g[m]},p={isValidating:!0};Q(S().data)&&(p.isLoading=!0);try{if(i&&(k(p),r.loadingTimeout&&Q(S().data)&&setTimeout(()=>{l&&c()&&A().onLoadingSlow(m,r)},r.loadingTimeout),g[m]=[n(E),eA()]),[t,o]=g[m],t=await t,i&&setTimeout(f,r.dedupingInterval),!g[m]||g[m][1]!==o)return i&&c()&&A().onDiscarded(m),!1;u.error=Z;let e=h[m];if(!Q(e)&&(o<=e[0]||o<=e[1]||0===e[1]))return d(),i&&c()&&A().onDiscarded(m),!1;let s=S().data;u.data=a(s,t)?s:t,i&&c()&&A().onSuccess(t,m,r)}catch(r){f();let e=A(),{shouldRetryOnError:t}=e;!e.isPaused()&&(u.error=r,i&&c()&&(e.onError(r,m,e),(!0===t||X(t)&&t(r))&&(!A().revalidateOnFocus||!A().revalidateOnReconnect||R())&&e.onErrorRetry(r,m,e,e=>{let t=_[m];t&&t[0]&&t[0](eR.ERROR_REVALIDATE_EVENT,e)},{retryCount:(s.retryCount||0)+1,dedupe:!0})))}return l=!1,d(),!0},[m,o]),z=(0,l.useCallback)((...e)=>eS(o,v.current,...e),[]);if(eb(()=>{w.current=t,T.current=r,Q(M)||(U.current=M)}),eb(()=>{if(!m)return;let e=q.bind(Z,eP),t=0,r=eJ(m,_,(r,o={})=>{if(r==eR.FOCUS_EVENT){let r=Date.now();A().revalidateOnFocus&&r>t&&R()&&(t=r+A().focusThrottleInterval,e())}else if(r==eR.RECONNECT_EVENT)A().revalidateOnReconnect&&R()&&e();else if(r==eR.MUTATE_EVENT)return q();else if(r==eR.ERROR_REVALIDATE_EVENT)return q(o)});return I.current=!1,v.current=m,b.current=!0,k({_k:E}),Y&&(Q(B)||em?e():eE(e)),()=>{I.current=!0,r()}},[m]),eb(()=>{let e;function t(){let t=X(u)?u(S().data):u;t&&-1!==e&&(e=setTimeout(r,t))}function r(){!S().error&&(d||A().isVisible())&&(f||A().isOnline())?q(eP).then(t):t()}return t(),()=>{e&&(clearTimeout(e),e=-1)}},[u,d,f,m]),(0,l.useDebugValue)(P),n&&Q(B)&&m){if(!ey&&em)throw Error("Fallback data is required when using suspense in SSR.");w.current=t,T.current=r,I.current=!1;let e=y[m];if(Q(e)||eU(z(e)),Q(J)){let e=q(eP);Q(P)||(e.status="fulfilled",e.value=!0),eU(e)}else throw J}return{mutate:z,get data(){return x.data=!0,P},get error(){return x.error=!0,J},get isValidating(){return x.isValidating=!0,W},get isLoading(){return x.isLoading=!0,K}}},function(...e){let t=eM(),[r,a,n]=eV(e),l=eO(t,n),s=o,{use:i}=l,c=(i||[]).concat(eB);for(let e=c.length;e--;)s=c[e](s);return s(r,a||l.fetcher||null,l)});var e$=r(32631);function eW(e,t){return null!=t?e$(e,t):e}var eK=async(e,t,r,o,a,n,l,s,i,c,u,d,f,p,_,h,g)=>{var y;let m=l.current;r(t.messages,!1);let E=p?t.messages:t.messages.map(({role:e,content:t,experimental_attachments:r,name:o,data:a,annotations:n,toolInvocations:l,function_call:s,tool_calls:i,tool_call_id:c})=>({role:e,content:t,...void 0!==r&&{experimental_attachments:r},...void 0!==o&&{name:o},...void 0!==a&&{data:a},...void 0!==n&&{annotations:n},...void 0!==l&&{toolInvocations:l},tool_call_id:c,...void 0!==s&&{function_call:s},...void 0!==i&&{tool_calls:i}})),b=a.current;return await Y({api:e,body:null!=(y=null==_?void 0:_({messages:t.messages,requestData:t.data,requestBody:t.body}))?y:{messages:E,data:t.data,...n.current.body,...t.body,...void 0!==t.functions&&{functions:t.functions},...void 0!==t.function_call&&{function_call:t.function_call},...void 0!==t.tools&&{tools:t.tools},...void 0!==t.tool_choice&&{tool_choice:t.tool_choice}},streamProtocol:c,credentials:n.current.credentials,headers:{...n.current.headers,...t.headers},abortController:()=>s.current,restoreMessagesOnFailure(){g||r(m,!1)},onResponse:d,onUpdate(e,a){r([...t.messages,...e],!1),o([...null!=b?b:[],...null!=a?a:[]],!1)},onToolCall:f,onFinish:u,generateId:i,fetch:h})};function eq(e){return"assistant"===e.role&&e.toolInvocations&&e.toolInvocations.length>0&&e.toolInvocations.every(e=>"result"in e)}async function eG(e){if(null==e)return[];if(e instanceof FileList)return Promise.all(Array.from(e).map(async e=>{let{name:t,type:r}=e;return{name:t,contentType:r,url:await new Promise((t,r)=>{let o=new FileReader;o.onload=e=>{var r;t(null==(r=e.target)?void 0:r.result)},o.onerror=e=>r(e),o.readAsDataURL(e)})}}));if(Array.isArray(e))return e;throw Error("Invalid attachments type")}var ez=function({api:e="/api/chat",id:t,initialMessages:r,initialInput:o="",sendExtraMessageFields:a,experimental_onFunctionCall:n,experimental_onToolCall:s,onToolCall:i,experimental_prepareRequestBody:c,experimental_maxAutomaticRoundtrips:u=0,maxAutomaticRoundtrips:d=u,maxToolRoundtrips:f=d,maxSteps:p=null!=f?f+1:1,streamMode:_,streamProtocol:h,onResponse:g,onFinish:m,onError:E,credentials:b,headers:I,body:v,generateId:w=y,fetch:T,keepLastMessageOnError:A=!1,experimental_throttle:R}={}){_&&(null!=h||(h="text"===_?"text":void 0));let S=(0,l.useId)(),k=null!=t?t:S,N="string"==typeof e?[e,k]:k,[C]=(0,l.useState)([]),{data:x,mutate:D}=eY([N,"messages"],null,{fallbackData:null!=r?r:C}),O=(0,l.useRef)(x||[]);(0,l.useEffect)(()=>{O.current=x||[]},[x]);let{data:F,mutate:L}=eY([N,"streamData"],null),j=(0,l.useRef)(F);(0,l.useEffect)(()=>{j.current=F},[F]);let{data:V=!1,mutate:M}=eY([N,"loading"],null),{data:B,mutate:J}=eY([N,"error"],null),U=(0,l.useRef)(null),P=(0,l.useRef)({credentials:b,headers:I,body:v});(0,l.useEffect)(()=>{P.current={credentials:b,headers:I,body:v}},[b,I,v]);let Y=(0,l.useCallback)(async t=>{let r=O.current.length;try{M(!0),J(void 0);let r=new AbortController;U.current=r,await q({getStreamedResponse:()=>eK(e,t,eW(D,R),eW(L,R),j,P,O,U,w,h,m,g,i,a,c,T,A),experimental_onFunctionCall:n,experimental_onToolCall:s,updateChatRequest:e=>{t=e},getCurrentMessages:()=>O.current}),U.current=null}catch(e){if("AbortError"===e.name)return U.current=null,null;E&&e instanceof Error&&E(e),J(e)}finally{M(!1)}let o=O.current,l=o[o.length-1];o.length>r&&null!=l&&p>1&&eq(l)&&function(e){let t=0;for(let r=e.length-1;r>=0;r--)if("assistant"===e[r].role)t++;else break;return t}(o)<p&&await Y({messages:o})},[D,M,e,P,g,m,E,J,L,j,h,a,n,s,c,i,p,O,U,w,T,A,R]),$=(0,l.useCallback)(async(e,{options:t,functions:r,function_call:o,tools:a,tool_choice:n,data:l,headers:s,body:i,experimental_attachments:c}={})=>{var u,d;e.id||(e.id=w());let f=await eG(c),p={headers:null!=s?s:null==t?void 0:t.headers,body:null!=i?i:null==t?void 0:t.body};return Y({messages:O.current.concat({...e,id:null!=(u=e.id)?u:w(),createdAt:null!=(d=e.createdAt)?d:new Date,experimental_attachments:f.length>0?f:void 0}),options:p,headers:p.headers,body:p.body,data:l,...void 0!==r&&{functions:r},...void 0!==o&&{function_call:o},...void 0!==a&&{tools:a},...void 0!==n&&{tool_choice:n}})},[Y,w]),W=(0,l.useCallback)(async({options:e,functions:t,function_call:r,tools:o,tool_choice:a,data:n,headers:l,body:s}={})=>{if(0===O.current.length)return null;let i={headers:null!=l?l:null==e?void 0:e.headers,body:null!=s?s:null==e?void 0:e.body};return"assistant"===O.current[O.current.length-1].role?Y({messages:O.current.slice(0,-1),options:i,headers:i.headers,body:i.body,data:n,...void 0!==t&&{functions:t},...void 0!==r&&{function_call:r},...void 0!==o&&{tools:o},...void 0!==a&&{tool_choice:a}}):Y({messages:O.current,options:i,headers:i.headers,body:i.body,data:n,...void 0!==t&&{functions:t},...void 0!==r&&{function_call:r},...void 0!==o&&{tools:o},...void 0!==a&&{tool_choice:a}})},[Y]),K=(0,l.useCallback)(()=>{U.current&&(U.current.abort(),U.current=null)},[]),G=(0,l.useCallback)(e=>{"function"==typeof e&&(e=e(O.current)),D(e,!1),O.current=e},[D]),z=(0,l.useCallback)(e=>{"function"==typeof e&&(e=e(j.current)),L(e,!1),j.current=e},[L]),[Z,H]=(0,l.useState)(o),Q=(0,l.useCallback)(async(e,t={},r)=>{var o,a,n,l,s;if(null==(o=null==e?void 0:e.preventDefault)||o.call(e),!Z&&!t.allowEmptySubmit)return;r&&(P.current={...P.current,...r});let i=await eG(t.experimental_attachments),c={headers:null!=(n=t.headers)?n:null==(a=t.options)?void 0:a.headers,body:null!=(s=t.body)?s:null==(l=t.options)?void 0:l.body};Y({messages:Z||i.length||!t.allowEmptySubmit?O.current.concat({id:w(),createdAt:new Date,role:"user",content:Z,experimental_attachments:i.length>0?i:void 0}):O.current,options:c,headers:c.headers,body:c.body,data:t.data}),H("")},[Z,w,Y]),X=({toolCallId:e,result:t})=>{let r=O.current.map((r,o,a)=>o===a.length-1&&"assistant"===r.role&&r.toolInvocations?{...r,toolInvocations:r.toolInvocations.map(r=>r.toolCallId===e?{...r,result:t}:r)}:r);D(r,!1),eq(r[r.length-1])&&Y({messages:r})};return{messages:x||[],setMessages:G,data:F,setData:z,error:B,append:$,reload:W,stop:K,input:Z,setInput:H,handleInputChange:e=>{H(e.target.value)},handleSubmit:Q,isLoading:V,addToolResult:X,experimental_addToolResult:X}},eZ=function({api:e="/api/completion",id:t,initialCompletion:r="",initialInput:o="",credentials:a,headers:n,body:s,streamMode:i,streamProtocol:c,fetch:u,onResponse:d,onFinish:f,onError:p,experimental_throttle:_}={}){i&&(null!=c||(c="text"===i?"text":void 0));let h=(0,l.useId)(),g=t||h,{data:y,mutate:m}=eY([e,g],null,{fallbackData:r}),{data:E=!1,mutate:b}=eY([g,"loading"],null),{data:I,mutate:v}=eY([g,"streamData"],null),[w,T]=(0,l.useState)(void 0),[A,R]=(0,l.useState)(null),S=(0,l.useRef)({credentials:a,headers:n,body:s});(0,l.useEffect)(()=>{S.current={credentials:a,headers:n,body:s}},[a,n,s]);let k=(0,l.useCallback)(async(t,r)=>W({api:e,prompt:t,credentials:S.current.credentials,headers:{...S.current.headers,...null==r?void 0:r.headers},body:{...S.current.body,...null==r?void 0:r.body},streamProtocol:c,fetch:u,setCompletion:eW(e=>m(e,!1),_),onData:eW(e=>v([...null!=I?I:[],...null!=e?e:[]],!1),_),setLoading:b,setError:T,setAbortController:R,onResponse:d,onFinish:f,onError:p}),[m,b,e,S,R,d,f,p,T,I,c,u,v,_]),N=(0,l.useCallback)(()=>{A&&(A.abort(),R(null))},[A]),C=(0,l.useCallback)(e=>{m(e,!1)},[m]),x=(0,l.useCallback)(async(e,t)=>k(e,t),[k]),[D,O]=(0,l.useState)(o),F=(0,l.useCallback)(e=>{var t;return null==(t=null==e?void 0:e.preventDefault)||t.call(e),D?x(D):void 0},[D,x]),L=(0,l.useCallback)(e=>{O(e.target.value)},[O]);return{completion:y,complete:x,error:w,setCompletion:C,stop:N,input:D,setInput:O,handleInputChange:L,handleSubmit:F,isLoading:E,data:I}}}}]);