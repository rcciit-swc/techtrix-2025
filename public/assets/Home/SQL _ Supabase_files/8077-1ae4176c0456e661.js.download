!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="67f73d0f-4a47-4e9c-ac6e-70b6c45dc55c",e._sentryDebugIdIdentifier="sentry-dbid-67f73d0f-4a47-4e9c-ac6e-70b6c45dc55c")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8077],{45724:function(e,t,a){a.d(t,{Z:function(){return l}});let l=(0,a(98266).Z)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},78077:function(e,t,a){a.d(t,{Z:function(){return ed}});var l=a(97458),i=a(12436),s=a(52983),n=a(34549),r=a(31485),o=a(62432),c=a(58326),d=a(37756),u=a(70284),m=a(86976),p=a(198),f=a(23382),h=a(3977),x=a(13510),y=a(83145),b=a.n(y),j=a(32691),v=a(98601),g=a(40102),_=a(90616),w=a(28927),k=a(36457),S=a(64618),N=a(6464),C=a(21922);async function z(e){let{projectRef:t,id:a,isPublic:l,file_size_limit:i,allowed_mime_types:s}=e;if(!t)throw Error("projectRef is required");if(!a)throw Error("Bucket name is required");let n={id:a,public:l};i&&(n.file_size_limit=i),s&&n.allowed_mime_types;let{data:r,error:o}=await (0,N.v_)("/platform/storage/{ref}/buckets",{params:{path:{ref:t}},body:n});return o&&(0,N.S3)(o),r}let Z=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,k.NL)();return(0,S.D)(e=>z(e),{async onSuccess(t,a,i){let{projectRef:s}=a;await l.invalidateQueries(C.m.buckets(s)),await (null==e?void 0:e(t,a,i))},async onError(e,a,l){void 0===t?n.Am.error("Failed to create bucket: ".concat(e.message)):t(e,a,l)},...a})};var E=a(42155),M=a(19540),B=a(51571),I=a(30739),T=a(10611),P=a(9450),R=a(65092),O=a(85818),F=a(90839),L=e=>{var t;let{visible:a,onClose:r}=e,{ref:o}=(0,i.UO)(),c=(0,j.useRouter)(),{mutate:u,isLoading:m}=Z({onSuccess:e=>{n.Am.success("Successfully created bucket ".concat(e.name)),c.push("/project/".concat(o,"/storage/buckets/").concat(e.name)),r()}}),{data:p}=(0,w.k)({projectRef:o},{enabled:d.Qy}),{value:f,unit:h}=(0,_.Ku)(null!==(t=null==p?void 0:p.fileSizeLimit)&&void 0!==t?t:0),x="".concat(f," ").concat(h),[y,k]=(0,s.useState)(g.b.BYTES),[S,N]=(0,s.useState)(!1),C=async e=>{if(!o)return console.error("Project ref is required");u({projectRef:o,id:e.name,isPublic:e.public,file_size_limit:e.has_file_size_limit?(0,_.Fm)(e.formatted_size_limit,y):null,allowed_mime_types:e.allowed_mime_types.length>0?e.allowed_mime_types.split(",").map(e=>e.trim()):null})};return(0,s.useEffect)(()=>{a&&(k(g.b.BYTES),N(!1))},[a]),(0,l.jsx)(E.Z,{hideFooter:!0,visible:a,size:"medium",header:"Create storage bucket",onCancel:()=>r(),"data-sentry-element":"Modal","data-sentry-component":"CreateBucketModal","data-sentry-source-file":"CreateBucketModal.tsx",children:(0,l.jsx)(M.Z,{validateOnBlur:!1,initialValues:{name:"",public:!1,file_size_limit:0,allowed_mime_types:"",has_file_size_limit:!1,formatted_size_limit:0},validate:e=>{let t={};return e.name||(t.name="Please provide a name for your bucket"),e.name&&e.name.endsWith(" ")&&(t.name="The name of the bucket cannot end with a whitespace"),e.has_file_size_limit&&e.formatted_size_limit<0&&(t.formatted_size_limit="File size upload limit has to be at least 0"),"public"===e.name&&(t.name='"public" is a reserved name. Please choose another name'),t},onSubmit:C,"data-sentry-element":"Form","data-sentry-source-file":"CreateBucketModal.tsx",children:e=>{let{values:t}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(E.Z.Content,{children:[(0,l.jsx)(B.Z,{id:"name",name:"name",type:"text",className:"w-full",layout:"vertical",label:"Name of bucket",labelOptional:"Buckets cannot be renamed once created.",descriptionText:"Only lowercase letters, numbers, dots, and hyphens"}),(0,l.jsxs)("div",{className:"space-y-2 mt-6",children:[(0,l.jsx)(I.Z,{id:"public",name:"public",layout:"flex",label:"Public bucket",descriptionText:"Anyone can read any object without any authorization"}),t.public&&(0,l.jsxs)(T.b,{title:"Public buckets are not protected",variant:"warning",withIcon:!0,children:[(0,l.jsx)("p",{className:"mb-2",children:"Users can read objects in public buckets without any authorization."}),(0,l.jsx)("p",{children:"Row level security (RLS) policies are still required for other operations such as object uploads and deletes."})]})]})]}),(0,l.jsxs)(P.ZP,{open:S,onOpenChange:()=>N(!S),children:[(0,l.jsx)(P.ZP.Trigger,{asChild:!0,children:(0,l.jsxs)("div",{className:"w-full cursor-pointer py-3 px-5 flex items-center justify-between border-t border-default",children:[(0,l.jsx)("p",{className:"text-sm",children:"Additional configuration"}),(0,l.jsx)(v.Z,{size:18,strokeWidth:2,className:(0,R.cn)("text-foreground-light",S&&"rotate-180")})]})}),(0,l.jsx)(P.ZP.Content,{className:"py-4",children:(0,l.jsxs)("div",{className:"w-full space-y-5 px-5",children:[(0,l.jsxs)("div",{className:"space-y-5",children:[(0,l.jsx)(I.Z,{id:"has_file_size_limit",name:"has_file_size_limit",layout:"flex",label:"Restrict file upload size for bucket",descriptionText:"Prevent uploading of file sizes greater than a specified limit"}),t.has_file_size_limit&&(0,l.jsxs)("div",{className:"grid grid-cols-12 col-span-12 gap-x-2 gap-y-1",children:[(0,l.jsx)("div",{className:"col-span-8",children:(0,l.jsx)(B.Z,{type:"number",step:1,id:"formatted_size_limit",name:"formatted_size_limit",disabled:!1,onKeyPress:e=>{(e.charCode<48||e.charCode>57)&&e.preventDefault()},descriptionText:"Equivalent to ".concat((0,_.Fm)(t.formatted_size_limit,y).toLocaleString()," bytes.")})}),(0,l.jsx)("div",{className:"col-span-4",children:(0,l.jsx)(O.Z,{id:"size_limit_units",disabled:!1,value:y,onChange:k,children:Object.values(g.b).map(e=>(0,l.jsx)(O.Z.Option,{label:e,value:e,children:(0,l.jsx)("div",{children:e})},e))})}),d.Qy&&(0,l.jsx)("div",{className:"col-span-12",children:(0,l.jsxs)("p",{className:"text-foreground-light text-sm",children:["Note: Individual bucket uploads will still be capped at the"," ",(0,l.jsx)(b(),{href:"/project/".concat(o,"/settings/storage"),className:"font-bold underline",children:"global upload limit"})," ","of ",x]})})]})]}),(0,l.jsx)(B.Z,{id:"allowed_mime_types",name:"allowed_mime_types",layout:"vertical",label:"Allowed MIME types",placeholder:"e.g image/jpeg, image/png, audio/mpeg, video/mp4, etc",labelOptional:"Comma separated values",descriptionText:"Wildcards are allowed, e.g. image/*. Leave blank to allow any MIME type."})]})})]}),(0,l.jsx)(E.Z.Separator,{}),(0,l.jsxs)(E.Z.Content,{className:"flex items-center space-x-2 justify-end",children:[(0,l.jsx)(F.z,{type:"default",htmlType:"button",disabled:m,onClick:()=>r(),children:"Cancel"}),(0,l.jsx)(F.z,{type:"primary",htmlType:"submit",loading:m,disabled:m,children:"Save"})]})]})}})})};async function A(e){let{projectRef:t,id:a,isPublic:l,file_size_limit:i,allowed_mime_types:s}=e;if(!t)throw Error("projectRef is required");if(!a)throw Error("Bucket name is requried");let n={public:l};i&&(n.file_size_limit=i),s&&(n.allowed_mime_types=s);let{data:r,error:o}=await (0,N.r$)("/platform/storage/{ref}/buckets/{id}",{params:{path:{id:a,ref:t}},body:n});return o&&(0,N.S3)(o),r}let D=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,k.NL)();return(0,S.D)(e=>A(e),{async onSuccess(t,a,i){let{projectRef:s}=a;await l.invalidateQueries(C.m.buckets(s)),await (null==e?void 0:e(t,a,i))},async onError(e,a,l){void 0===t?n.Am.error("Failed to update bucket: ".concat(e.message)):t(e,a,l)},...a})};var q=e=>{var t;let{visible:a,bucket:r,onClose:o}=e,{ref:c}=(0,i.UO)(),{mutate:u,isLoading:m}=D({onSuccess:()=>{n.Am.success('Successfully updated bucket "'.concat(null==r?void 0:r.name,'"')),o()}}),{data:p}=(0,w.k)({projectRef:c},{enabled:d.Qy}),{value:f,unit:h}=(0,_.Ku)(null!==(t=null==p?void 0:p.fileSizeLimit)&&void 0!==t?t:0),x="".concat(f," ").concat(h),[y,j]=(0,s.useState)(g.b.BYTES),[k,S]=(0,s.useState)(!1),N=async e=>void 0===r?console.error("Bucket is required"):void 0===c?console.error("Project ref is required"):void u({projectRef:c,id:r.id,isPublic:e.public,file_size_limit:e.has_file_size_limit?(0,_.Fm)(e.formatted_size_limit,y):null,allowed_mime_types:e.allowed_mime_types.length>0?e.allowed_mime_types.split(",").map(e=>e.trim()):null});return(0,s.useEffect)(()=>{if(a){var e;let{unit:t}=(0,_.Ku)(null!==(e=null==r?void 0:r.file_size_limit)&&void 0!==e?e:0);j(t),S(!1)}},[a]),(0,l.jsx)(E.Z,{hideFooter:!0,visible:a,size:"medium",header:'Edit bucket "'.concat(null==r?void 0:r.name,'"'),onCancel:o,"data-sentry-element":"Modal","data-sentry-component":"EditBucketModal","data-sentry-source-file":"EditBucketModal.tsx",children:(0,l.jsx)(M.Z,{validateOnBlur:!1,initialValues:{},validate:e=>{let t={};return e.has_file_size_limit&&e.formatted_size_limit<0&&(t.formatted_size_limit="File size upload limit has to be at least 0"),t},onSubmit:N,"data-sentry-element":"Form","data-sentry-source-file":"EditBucketModal.tsx",children:e=>{let{values:t,resetForm:i}=e;return(0,s.useEffect)(()=>{if(a&&void 0!==r){var e,t,l;let{value:a}=(0,_.Ku)(null!==(e=r.file_size_limit)&&void 0!==e?e:0),s={name:null!==(t=r.name)&&void 0!==t?t:"",public:r.public,file_size_limit:r.file_size_limit,allowed_mime_types:(null!==(l=r.allowed_mime_types)&&void 0!==l?l:[]).join(", "),has_file_size_limit:null!==r.file_size_limit,formatted_size_limit:null!=a?a:0};i({values:s,initialValues:s})}},[a]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(E.Z.Content,{children:[(0,l.jsx)(B.Z,{disabled:!0,id:"name",name:"name",type:"text",className:"w-full",layout:"vertical",label:"Name of bucket",labelOptional:"Buckets cannot be renamed once created."}),(0,l.jsxs)("div",{className:"space-y-2 mt-6",children:[(0,l.jsx)(I.Z,{id:"public",name:"public",layout:"flex",label:"Public bucket",descriptionText:"Anyone can read any object without any authorization"}),(null==r?void 0:r.public)!==t.public&&(0,l.jsx)(T.b,{title:(null==r?void 0:r.public)||!t.public?(null==r?void 0:r.public)&&!t.public?"Warning: Making bucket private":"":"Warning: Making bucket public",variant:"warning",withIcon:!0,children:(0,l.jsx)("p",{className:"mb-2",children:(null==r?void 0:r.public)||!t.public?(null==r?void 0:r.public)&&!t.public?'All objects in "'.concat(null==r?void 0:r.name,'" will be made private and will only be accessible via signed URLs or downloaded with the right authorisation headers'):"":'This will make all objects in the bucket "'.concat(null==r?void 0:r.name,'" public')})})]})]}),(0,l.jsxs)(P.ZP,{open:k,onOpenChange:()=>S(!k),children:[(0,l.jsx)(P.ZP.Trigger,{asChild:!0,children:(0,l.jsxs)("div",{className:"w-full cursor-pointer py-3 px-5 flex items-center justify-between border-t border-default",children:[(0,l.jsx)("p",{className:"text-sm",children:"Additional configuration"}),(0,l.jsx)(v.Z,{size:18,strokeWidth:2,className:(0,R.cn)("text-foreground-light",k&&"rotate-180")})]})}),(0,l.jsx)(P.ZP.Content,{className:"py-4",children:(0,l.jsxs)("div",{className:"w-full space-y-4 px-5",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(I.Z,{id:"has_file_size_limit",name:"has_file_size_limit",layout:"flex",label:"Restrict file upload size for bucket",descriptionText:"Prevent uploading of file sizes greater than a specified limit"}),t.has_file_size_limit&&(0,l.jsxs)("div",{className:"grid grid-cols-12 col-span-12 gap-x-2 gap-y-1",children:[(0,l.jsx)("div",{className:"col-span-8",children:(0,l.jsx)(B.Z,{type:"number",step:1,id:"formatted_size_limit",name:"formatted_size_limit",disabled:!1,onKeyPress:e=>{(e.charCode<48||e.charCode>57)&&e.preventDefault()},descriptionText:"Equivalent to ".concat((0,_.Fm)(t.formatted_size_limit,y).toLocaleString()," bytes.")})}),(0,l.jsx)("div",{className:"col-span-4",children:(0,l.jsx)(O.Z,{id:"size_limit_units",disabled:!1,value:y,onChange:j,children:Object.values(g.b).map(e=>(0,l.jsx)(O.Z.Option,{label:e,value:e,children:(0,l.jsx)("div",{children:e})},e))})}),d.Qy&&(0,l.jsx)("div",{className:"col-span-12 mt-2",children:(0,l.jsxs)("p",{className:"text-foreground-light text-sm",children:["Note: Individual bucket upload will still be capped at the"," ",(0,l.jsx)(b(),{href:"/project/".concat(c,"/settings/storage"),className:"font-bold underline",children:"global upload limit"})," ","of ",x]})})]})]}),(0,l.jsx)(B.Z,{id:"allowed_mime_types",name:"allowed_mime_types",layout:"vertical",label:"Allowed MIME types",placeholder:"e.g image/jpeg, image/png, audio/mpeg, video/mp4, etc",labelOptional:"Comma separated values",descriptionText:"Wildcards are allowed, e.g. image/*. Leave blank to allow any MIME type."})]})})]}),(0,l.jsx)(E.Z.Separator,{}),(0,l.jsxs)(E.Z.Content,{className:"flex items-center space-x-2 justify-end",children:[(0,l.jsx)(F.z,{type:"default",disabled:m,onClick:()=>o(),children:"Cancel"}),(0,l.jsx)(F.z,{type:"primary",htmlType:"submit",loading:m,disabled:m,children:"Save"})]})]})}})})},W=a(86384);async function K(e){let{projectRef:t,id:a}=e;if(!t)throw Error("projectRef is required");if(!a)throw Error("Bucket name is requried");let{data:l,error:i}=await (0,N.v_)("/platform/storage/{ref}/buckets/{id}/empty",{params:{path:{id:a,ref:t}}});return i&&(0,N.S3)(i),l}let U=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,k.NL)();return(0,S.D)(e=>K(e),{async onSuccess(t,a,i){let{projectRef:s}=a;await l.invalidateQueries(C.m.buckets(s)),await (null==e?void 0:e(t,a,i))},async onError(e,a,l){void 0===t?n.Am.error("Failed to empty bucket: ".concat(e.message)):t(e,a,l)},...a})};var V=a(32002);let Q=e=>{let{visible:t=!1,bucket:a,onClose:s}=e,{ref:r}=(0,i.UO)(),{fetchFolderContents:o}=(0,u.H)(),{mutate:c,isLoading:d}=U({onSuccess:async()=>{void 0!==a&&(await o(a.id,a.name,-1),n.Am.success("Successfully deleted bucket ".concat(a.name)),s())}}),m=async()=>r?a?void c({projectRef:r,id:a.id}):console.error("No bucket is selected"):console.error("Project ref is required");return(0,l.jsx)(V.Z,{variant:"destructive",size:"small",title:"Confirm to delete all contents from ".concat(null==a?void 0:a.name),confirmLabel:"Empty bucket",visible:t,onCancel:()=>s(),onConfirm:m,alert:{title:"This action cannot be undone",description:"The contents of your bucket cannot be recovered once deleted"},"data-sentry-element":"ConfirmationModal","data-sentry-component":"EmptyBucketModal","data-sentry-source-file":"EmptyBucketModal.tsx",children:(0,l.jsxs)("p",{className:"text-sm",children:['Are you sure you want to empty the bucket "',null==a?void 0:a.name,'"?']})})};var X=a(359),Y=a(63621),G=a(82218),J=a(90817),H=a(94059),$=a(10947),ee=a(52114),et=a(71607),ea=a.n(et),el=a(34133),ei=a(45724),es=a(74304),en=a(73565),er=a(14500),eo=e=>{let{bucket:t,projectRef:a="",isSelected:i=!1,onSelectEmptyBucket:s=ea(),onSelectDeleteBucket:n=ea(),onSelectEditBucket:r=ea()}=e,o=(0,J.Xo)(p.KA.STORAGE_WRITE,"*");return(0,l.jsxs)("div",{className:(0,R.cn)("group flex items-center justify-between rounded-md",i&&"text-foreground bg-surface-100"),"data-sentry-component":"BucketRow","data-sentry-source-file":"BucketRow.tsx",children:[(0,l.jsx)(b(),{href:"/project/".concat(a,"/storage/buckets/").concat(encodeURIComponent(t.id)),className:(0,R.cn)("py-1 px-3",i?"w-[88%]":"w-full"),"data-sentry-element":"Link","data-sentry-source-file":"BucketRow.tsx",children:(0,l.jsxs)("div",{className:"flex items-center justify-between space-x-2 truncate w-full",children:[(0,l.jsx)("p",{className:"text-sm group-hover:text-foreground transition truncate ".concat(i?"text-foreground":"text-foreground-light"),title:t.name,children:t.name}),t.public&&(0,l.jsx)(en.C,{variant:"warning",children:"Public"})]})}),o&&i?(0,l.jsxs)(er.h_,{children:[(0,l.jsx)(er.$F,{asChild:!0,children:(0,l.jsx)(F.z,{type:"text",icon:(0,l.jsx)(v.Z,{}),className:"mr-1 p-0.5"})}),(0,l.jsxs)(er.AW,{side:"bottom",align:"start",children:[(0,l.jsxs)(er.Xi,{className:"space-x-2",onClick:()=>r(),children:[(0,l.jsx)(el.Z,{size:14}),(0,l.jsx)("p",{children:"Edit bucket"})]},"toggle-private"),(0,l.jsx)(er.VD,{}),(0,l.jsxs)(er.Xi,{className:"space-x-2",onClick:()=>s(),children:[(0,l.jsx)(ei.Z,{size:14}),(0,l.jsx)("p",{children:"Empty bucket"})]},"empty-bucket"),(0,l.jsxs)(er.Xi,{className:"space-x-2",onClick:()=>n(),children:[(0,l.jsx)(es.Z,{size:14}),(0,l.jsx)("p",{children:"Delete bucket"})]},"delete-bucket")]})]}):(0,l.jsx)("div",{className:"w-5"})]},t.id)},ec=()=>{let e=(0,j.useRouter)(),{ref:t,bucketId:a}=(0,i.UO)(),n=(0,o.Vm)(),r=(null==n?void 0:n.parent_project_ref)!==void 0,[c,d]=(0,s.useState)(""),[u,m]=(0,s.useState)(!1),[y,v]=(0,s.useState)(),[g,_]=(0,s.useState)(),[w,k]=(0,s.useState)(),S=(0,J.Xo)(p.KA.STORAGE_WRITE,"*"),[N,C]=(0,f._)("storage-explorer-sort","created-at"),z=e.pathname.split("/")[4],{data:Z,error:E,isLoading:M,isError:B,isSuccess:I}=(0,G.K)({projectRef:t}),T=null!=Z?Z:[],P="alphabetical"===N?T.sort((e,t)=>e.name.toLowerCase().trim().localeCompare(t.name.toLowerCase().trim())):T.sort((e,t)=>new Date(t.created_at)>new Date(e.created_at)?-1:1),R=c.length>1?P.filter(e=>e.name.includes(c.trim())):P,O=(null==E?void 0:E.message.includes("Tenant config"))&&r;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(H.ZP,{type:"pills",className:"my-6 flex flex-grow flex-col","data-sentry-element":"Menu","data-sentry-source-file":"StorageMenu.tsx",children:[(0,l.jsxs)("div",{className:"mb-6 mx-5 flex flex-col gap-y-1.5",children:[(0,l.jsx)(X.u,{block:!0,type:"default",icon:(0,l.jsx)(h.Z,{}),disabled:!S,style:{justifyContent:"start"},onClick:()=>m(!0),tooltip:{content:{side:"bottom",text:S?void 0:"You need additional permissions to create buckets"}},"data-sentry-element":"ButtonTooltip","data-sentry-source-file":"StorageMenu.tsx",children:"New bucket"}),(0,l.jsx)(ee.nM,{className:"px-0","data-sentry-element":"InnerSideBarFilters","data-sentry-source-file":"StorageMenu.tsx",children:(0,l.jsx)(ee.nn,{name:"search-buckets","aria-labelledby":"Search buckets",placeholder:"Search buckets...",value:c,onChange:e=>{d(e.target.value)},"data-sentry-element":"InnerSideBarFilterSearchInput","data-sentry-source-file":"StorageMenu.tsx",children:(0,l.jsxs)(ee.ZY,{value:N,onValueChange:e=>C(e),"data-sentry-element":"InnerSideBarFilterSortDropdown","data-sentry-source-file":"StorageMenu.tsx",children:[(0,l.jsx)(ee.IR,{value:"alphabetical",className:"flex gap-2","data-sentry-element":"InnerSideBarFilterSortDropdownItem","data-sentry-source-file":"StorageMenu.tsx",children:"Alphabetical"},"alphabetical"),(0,l.jsx)(ee.IR,{value:"created-at","data-sentry-element":"InnerSideBarFilterSortDropdownItem","data-sentry-source-file":"StorageMenu.tsx",children:"Created at"},"created-at")]})})})]}),(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"mx-3",children:[(0,l.jsx)(H.ZP.Group,{title:(0,l.jsx)("span",{className:"uppercase font-mono",children:"All buckets"}),"data-sentry-element":"unknown","data-sentry-source-file":"StorageMenu.tsx"}),M&&(0,l.jsxs)("div",{className:"space-y-2 mx-2",children:[(0,l.jsx)(Y.Z,{className:"!py-2.5"}),(0,l.jsx)(Y.Z,{className:"!py-2.5"}),(0,l.jsx)(Y.Z,{className:"!py-2.5"})]}),B&&(0,l.jsx)("div",{className:"px-2",children:(0,l.jsxs)($.bZ,{variant:O?"default":"warning",children:[(0,l.jsx)($.Cd,{className:"text-xs tracking-normal",children:O?"Storage is not available on preview branches for now":"Failed to fetch buckets"}),(0,l.jsx)($.X,{className:"text-xs",children:O?"We're actively looking into making this available on preview branches":"Please refresh to try again"})]})}),I&&(0,l.jsxs)(l.Fragment,{children:[0===T.length&&(0,l.jsx)(ee.Cf,{className:"mx-2",title:"No buckets available",description:"Buckets that you create will appear here"}),c.length>0&&0===R.length&&(0,l.jsx)(ee.Cf,{className:"mx-2",title:"No results found",description:'Your search for "'.concat(c,'" did not return any results')}),R.map((e,i)=>{let s=a===e.id;return(0,l.jsx)(eo,{bucket:e,projectRef:t,isSelected:s,onSelectEmptyBucket:()=>_(e),onSelectDeleteBucket:()=>k(e),onSelectEditBucket:()=>v(e)},"".concat(i,"_").concat(e.id))})]})]}),(0,l.jsx)("div",{className:"h-px w-full bg-border"}),(0,l.jsxs)("div",{className:"mx-3",children:[(0,l.jsx)(H.ZP.Group,{title:(0,l.jsx)("span",{className:"uppercase font-mono",children:"Configuration"}),"data-sentry-element":"unknown","data-sentry-source-file":"StorageMenu.tsx"}),(0,l.jsx)(b(),{href:"/project/".concat(t,"/storage/policies"),"data-sentry-element":"Link","data-sentry-source-file":"StorageMenu.tsx",children:(0,l.jsx)(H.ZP.Item,{rounded:!0,active:"policies"===z,"data-sentry-element":"unknown","data-sentry-source-file":"StorageMenu.tsx",children:(0,l.jsx)("p",{className:"truncate",children:"Policies"})})}),(0,l.jsx)(b(),{href:"/project/".concat(t,"/settings/storage"),"data-sentry-element":"Link","data-sentry-source-file":"StorageMenu.tsx",children:(0,l.jsx)(H.ZP.Item,{rounded:!0,"data-sentry-element":"unknown","data-sentry-source-file":"StorageMenu.tsx",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("p",{className:"truncate",children:"Settings"}),(0,l.jsx)(x.Z,{strokeWidth:1,className:"h-4 w-4","data-sentry-element":"ArrowUpRight","data-sentry-source-file":"StorageMenu.tsx"})]})})})]})]})]}),(0,l.jsx)(L,{visible:u,onClose:()=>m(!1),"data-sentry-element":"CreateBucketModal","data-sentry-source-file":"StorageMenu.tsx"}),(0,l.jsx)(q,{visible:void 0!==y,bucket:y,onClose:()=>v(void 0),"data-sentry-element":"EditBucketModal","data-sentry-source-file":"StorageMenu.tsx"}),(0,l.jsx)(Q,{visible:void 0!==g,bucket:g,onClose:()=>_(void 0),"data-sentry-element":"EmptyBucketModal","data-sentry-source-file":"StorageMenu.tsx"}),(0,l.jsx)(W.Iw,{visible:void 0!==w,bucket:w,onClose:()=>k(void 0),"data-sentry-element":"DeleteBucketModal","data-sentry-source-file":"StorageMenu.tsx"})]})},ed=(0,c.Q)(e=>{var t;let{title:a,children:c}=e,{ref:p}=(0,i.UO)(),f=(0,o.Vm)(),h=(0,u.H)(),{data:x,isLoading:y}=(0,r.zR)({projectRef:p}),b=null==x?void 0:null===(t=x.app_config)||void 0===t?void 0:t.endpoint,{serviceKey:j}=(0,r.Pb)(x),v=(null==f?void 0:f.status)===d.S.INACTIVE;(0,s.useEffect)(()=>{!y&&b&&(null==j?void 0:j.api_key)&&g(b,j.api_key)},[y,p,b,null==j?void 0:j.api_key]);let g=async(e,t)=>{if(!v){if(e){var a,l;let i=null!==(l=null==x?void 0:null===(a=x.app_config)||void 0===a?void 0:a.protocol)&&void 0!==l?l:"https";h.initStore(p,e,t,i)}else n.Am.error("Failed to fetch project configuration. Try refreshing your browser, or reach out to us at support@supabase.io")}};return(0,l.jsx)(m.Z,{title:a||"Storage",product:"Storage",productMenu:(0,l.jsx)(ec,{}),"data-sentry-element":"ProjectLayout","data-sentry-component":"StorageLayout","data-sentry-source-file":"StorageLayout.tsx",children:c})})},9450:function(e,t,a){var l=a(97458),i=a(99517);a(52983);var s=a(25843);let n=e=>{let{open:t,children:a,className:s,...n}=e;return(0,l.jsx)(i.fC,{asChild:n.asChild,defaultOpen:n.defaultOpen,open:t,onOpenChange:n.onOpenChange,disabled:n.disabled,className:s,"data-sentry-element":"unknown","data-sentry-component":"Collapsible","data-sentry-source-file":"Collapsible.tsx",children:a})};n.Trigger=function(e){let{children:t,asChild:a}=e;return(0,l.jsx)(i.xz,{asChild:a,"data-sentry-element":"unknown","data-sentry-component":"Trigger","data-sentry-source-file":"Collapsible.tsx",children:t})},n.Content=function(e){let{asChild:t,children:a,className:n}=e,r=(0,s.Z)("collapsible");return(0,l.jsx)(i.VY,{asChild:t,className:[r.content,n].join(" "),"data-sentry-element":"unknown","data-sentry-component":"Content","data-sentry-source-file":"Collapsible.tsx",children:a})},t.ZP=n},23382:function(e,t,a){a.d(t,{Nr:function(){return s},_:function(){return u}});var l=a(52983);function i(e,t){window.dispatchEvent(new StorageEvent("storage",{key:e,newValue:t}))}function s(e,t){let[a,i]=l.useState(e);return l.useEffect(()=>{let a=setTimeout(()=>{i(e)},t);return()=>{clearTimeout(a)}},[e,t]),a}let n=(e,t)=>{let a=JSON.stringify(t);window.localStorage.setItem(e,a),i(e,a)},r=e=>{window.localStorage.removeItem(e),i(e,null)},o=e=>window.localStorage.getItem(e),c=e=>(window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)),d=()=>{throw Error("useLocalStorage is a client-only hook")};function u(e,t){let a=l.useSyncExternalStore(c,()=>o(e),d),i=l.useCallback(t=>{try{let l="function"==typeof t?t(JSON.parse(a)):t;null==l?r(e):n(e,l)}catch(e){console.warn(e)}},[e,a]);return l.useEffect(()=>{null===o(e)&&void 0!==t&&n(e,t)},[e,t]),[a?JSON.parse(a):t,i]}}}]);