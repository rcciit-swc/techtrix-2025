!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="4316f9ed-1940-4bdf-9d6c-2fb8ecf8d7f3",e._sentryDebugIdIdentifier="sentry-dbid-4316f9ed-1940-4bdf-9d6c-2fb8ecf8d7f3")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7027],{45862:function(e,n,t){t.d(n,{l5:function(){return ex.Z},mM:function(){return eR}});var i=t(97458),o=t(198),a=t(36457),r=t(26969),l=t.n(r),s=t(86474),c=t.n(s),d=t(32691),u=t(34549),m=t(12436),f=t(62095),h=t(27850),p=t(88971),g=t(67096),x=t(89199),v=t(79790),y=t(91209),b=t(90817),j=t(72048),w=t(53114),S=t(96444),N=t(56844),D=t(24561),C=t(96226),A=t(74828),E=t(11024),R=t(61379),_=t(37722),k=t(83145),L=t.n(k),z=t(52983),T=t(98495),Z=t(99359),I=t(26233),F=t(359),q=t(92259),M=t(52417),O=t(1575),V=t(44353),W=t(82288),U=t(30457),G=t(41135),Q=t(71147),P=t(40577),K=t(90839),H=t(65092),J=t(42026),X=t(32472),Y=t(32002),B=t(96273),$=t(28894),ee=t(25878),en=t(7324);let et=e=>{let{id:n}=e;if(!n)throw Error("id is required");return"\n    with table_info as (\n      select \n        n.nspname::text as schema,\n        c.relname::text as name,\n        to_regclass(concat('\"', n.nspname, '\".\"', c.relname, '\"')) as regclass\n      from pg_class c\n      join pg_namespace n on n.oid = c.relnamespace\n      where c.oid = ".concat(n,"\n    )\n    select pg_get_viewdef(t.regclass, true) as definition\n    from table_info t\n  ").trim()};async function ei(e,n){let{projectRef:t,connectionString:i,id:o}=e,a=et({id:o}),{result:r}=await (0,ee.R)({projectRef:t,connectionString:i,sql:a,queryKey:["view-definition",o]},n);return r[0].definition.trim()}let eo=function(e){let{projectRef:n,connectionString:t,id:i}=e,{enabled:o=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,$.a)(en.A.viewDefinition(n,i),e=>{let{signal:o}=e;return ei({projectRef:n,connectionString:t,id:i},o)},{enabled:o&&void 0!==n&&void 0!==i&&!isNaN(i),...a})};var ea=t(66802),er=t(64890),el=t(35808),es=t(3190);function ec(e){let{table:n,isAutofixViewSecurityModalOpen:t,setIsAutofixViewSecurityModalOpen:o}=e,{project:r}=(0,p.d2)(),l=(0,a.NL)(),s=eo({id:null==n?void 0:n.id,projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString}),{mutate:c}=(0,ea.r)({onSuccess:async()=>{u.Am.success("View security changed successfully"),o(!1),await l.invalidateQueries(es.X.lint(null==r?void 0:r.ref))},onError:e=>{u.Am.error("Failed to autofix view security: ".concat(e.message))}});return(0,i.jsxs)(Y.Z,{visible:t,size:"xlarge",title:"Confirm autofixing view security",confirmLabel:"Confirm",onCancel:()=>o(!1),onConfirm:()=>{!function(){let e='\n	ALTER VIEW "'.concat(n.schema,'"."').concat(n.name,'" SET (security_invoker = on);\n	');c({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,sql:e})}()},"data-sentry-element":"ConfirmationModal","data-sentry-component":"ViewEntityAutofixSecurityModal","data-sentry-source-file":"ViewEntityAutofixSecurityModal.tsx",children:[(0,i.jsxs)("p",{className:"text-sm text-foreground-light",children:["Setting ",(0,i.jsx)("code",{children:"security_invoker=on"})," ensures the View runs with the permissions of the querying user, reducing the risk of unintended data exposure."]}),(0,i.jsxs)("div",{className:"flex items-center gap-8 mt-8",children:[(0,i.jsxs)("div",{className:" border rounded-md w-1/2",children:[(0,i.jsx)("div",{className:"p-4 bg-200 font-mono text-sm font-semibold",children:"Existing query"}),(0,i.jsx)(er.x,{className:"h-[225px] px-4 py-2","data-sentry-element":"ScrollArea","data-sentry-source-file":"ViewEntityAutofixSecurityModal.tsx",children:s.data&&(0,i.jsx)(el.c,{children:"create view ".concat(n.schema,".").concat(n.name," as\n ").concat(s.data)})})]}),(0,i.jsxs)("div",{className:" border rounded-md w-1/2",children:[(0,i.jsx)("div",{className:"p-4 bg-200 font-mono text-sm font-semibold",children:"Updated query"}),(0,i.jsx)(er.x,{className:"h-[225px] px-4 py-2","data-sentry-element":"ScrollArea","data-sentry-source-file":"ViewEntityAutofixSecurityModal.tsx",children:s.data&&(0,i.jsx)(el.c,{children:"create view ".concat(n.schema,".").concat(n.name," with (security_invoker = on) as\n ").concat(s.data)})})]})]})]})}var ed=t(75541),eu=e=>{var n;let{table:t}=e,{ref:a}=(0,m.UO)(),{project:r}=(0,p.d2)(),l=(0,ed.l)(),{data:s=[]}=(0,V.U)({projectRef:null==r?void 0:r.ref}),c=(0,x.N3)(t),d=(0,x.GV)(t),f=(0,x.Du)(t),h=(0,x.z_)(t),g=(0,Q.N)("realtime:all"),v=S.s.includes(t.schema),{mutate:y}=(0,G.V)({onError:e=>{u.Am.error("Failed to toggle RLS: ".concat(e.message))},onSettled:()=>{eS()}}),[j,w]=(0,z.useState)(!1),[N,D]=(0,z.useState)(!1),[C,k]=(0,z.useState)(!1),[$,ee]=(0,z.useState)(!1),{selectedRows:en}=(0,T.Qq)(),et=0===en.size,ei=null==r?void 0:r.ref,{data:eo}=(0,q.r)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString}),ea=(null!=eo?eo:[]).filter(e=>e.schema===t.schema&&e.table===t.name),{data:er}=(0,M.z)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString}),el=(null!=er?er:[]).find(e=>"supabase_realtime"===e.name),es=null!==(n=null==el?void 0:el.tables)&&void 0!==n?n:[],eu=es.some(e=>e.id===(null==t?void 0:t.id)),{mutate:em,isLoading:ef}=(0,O.u)({onSuccess:()=>{D(!1)},onError:e=>{u.Am.error("Failed to toggle realtime for ".concat(t.name,": ").concat(e.message))}}),eh=(0,b.Xo)(o.KA.TENANT_SQL_ADMIN_WRITE,"tables"),ep=(0,b.Xo)(o.KA.TENANT_SQL_ADMIN_WRITE,"columns"),eg="public"===t.schema,{hasLint:ex,matchingLint:ev}=(0,Z.R)(t.name,"security_definer_view",["ERROR","WARN"],s,t.schema),{hasLint:ey,matchingLint:eb}=(0,Z.R)(t.name,"materialized_view_in_api",["ERROR","WARN"],s,t.schema),{mutate:ej}=(0,W.a)(),ew=async()=>{var e,n;if(!r)return console.error("Project is required");if(!el)return console.error("Unable to find realtime publication");let i=es.some(e=>e.id==t.id),o=i?es.filter(e=>e.id!=t.id).map(e=>"".concat(e.schema,".").concat(e.name)):["".concat(t.schema,".").concat(t.name)].concat(es.map(e=>"".concat(e.schema,".").concat(e.name)));ej({action:U.b.REALTIME_TOGGLE_TABLE_CLICKED,properties:{newState:i?"disabled":"enabled",origin:"tableGridHeader"},groups:{project:null!==(e=null==r?void 0:r.ref)&&void 0!==e?e:"Unknown",organization:null!==(n=null==l?void 0:l.slug)&&void 0!==n?n:"Unknown"}}),em({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,id:el.id,tables:o})},eS=()=>{k(!1)},eN=async()=>{let e={id:t.id,rls_enabled:!(c&&t.rls_enabled)};y({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,id:e.id,schema:t.schema,payload:e})};return(0,i.jsxs)(i.Fragment,{children:[et&&(0,i.jsxs)("div",{className:"flex items-center gap-x-2",children:[!eh&&!ep&&(0,i.jsxs)(P.u,{children:[(0,i.jsx)(P.aJ,{asChild:!0,children:(0,i.jsx)("div",{className:"border border-strong rounded bg-overlay-hover px-3 py-1 text-xs",children:"Viewing as read-only"})}),(0,i.jsx)(P._v,{side:"bottom",children:"You need additional permissions to manage your project's data"})]}),c&&!v?t.rls_enabled?(0,i.jsx)(i.Fragment,{children:ea.length<1&&!v?(0,i.jsx)(F.u,{asChild:!0,type:"default",className:"group",icon:(0,i.jsx)(A.Z,{strokeWidth:1.5,className:"text-foreground-muted"}),tooltip:{content:{side:"bottom",className:"w-[280px]",text:"RLS is enabled for this table, but no policies are set. Select queries may return 0 results."}},children:(0,i.jsx)(L(),{passHref:!0,href:"/project/".concat(ei,"/auth/policies?search=").concat(t.id,"&schema=").concat(t.schema),children:"Add RLS policy"})}):(0,i.jsx)(K.z,{asChild:!0,type:ea.length<1&&!v?"warning":"default",className:"group",icon:v||ea.length>0?(0,i.jsx)("div",{className:(0,H.cn)("flex items-center justify-center rounded-full bg-border-stronger h-[16px]",ea.length>9?" px-1":"w-[16px]",""),children:(0,i.jsx)("span",{className:"text-[11px] text-foreground font-mono text-center",children:ea.length})}):(0,i.jsx)(A.Z,{strokeWidth:1.5}),children:(0,i.jsxs)(L(),{passHref:!0,href:"/project/".concat(ei,"/auth/policies?search=").concat(t.id,"&schema=").concat(t.schema),children:["Auth ",ea.length>1?"policies":"policy"]})})}):(0,i.jsxs)(J.J2,{open:j,onOpenChange:()=>w(!j),modal:!1,children:[(0,i.jsx)(J.xo,{asChild:!0,children:(0,i.jsx)(K.z,{type:"warning",icon:(0,i.jsx)(E.Z,{strokeWidth:1.5}),children:"RLS disabled"})}),(0,i.jsxs)(J.yk,{className:"min-w-[395px] text-sm",align:"end",children:[(0,i.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,i.jsx)(E.Z,{size:16})," Row Level Security (RLS)"]}),(0,i.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,i.jsx)("p",{children:"You can restrict and control who can read, write and update data in this table using Row Level Security."}),(0,i.jsx)("p",{children:"With RLS enabled, anonymous users will not be able to read/write data in the table."}),!v&&(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsx)(K.z,{type:"default",onClick:()=>k(!C),children:"Enable RLS for this table"})})]})]})]}):null,f&&ex&&(0,i.jsxs)(J.J2,{open:j,onOpenChange:()=>w(!j),modal:!1,children:[(0,i.jsx)(J.xo,{asChild:!0,children:(0,i.jsx)(K.z,{type:"warning",icon:(0,i.jsx)(R.Z,{strokeWidth:1.5}),children:"Security Definer view"})}),(0,i.jsxs)(J.yk,{className:"min-w-[395px] text-sm",align:"end",children:[(0,i.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,i.jsx)(R.Z,{size:16})," Secure your View"]}),(0,i.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,i.jsx)("p",{children:"This view is defined with the Security Definer property, giving it permissions of the view's creator (Postgres), rather than the permissions of the querying user."}),(0,i.jsx)("p",{children:"Since this view is in the public schema, it is accessible via your project's APIs."}),(0,i.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,i.jsx)(K.z,{type:"secondary",onClick:()=>{ee(!0)},children:"Autofix"}),(0,i.jsx)(K.z,{type:"default",asChild:!0,children:(0,i.jsx)(L(),{target:"_blank",href:"/project/".concat(a,"/advisors/security?preset=").concat(null==ev?void 0:ev.level,"&id=").concat(null==ev?void 0:ev.cache_key),children:"Learn more"})})]})]})]})]}),h&&ey&&(0,i.jsxs)(J.J2,{open:j,onOpenChange:()=>w(!j),modal:!1,children:[(0,i.jsx)(J.xo,{asChild:!0,children:(0,i.jsx)(K.z,{type:"warning",icon:(0,i.jsx)(R.Z,{strokeWidth:1.5}),children:"Security Definer view"})}),(0,i.jsxs)(J.yk,{className:"min-w-[395px] text-sm",align:"end",children:[(0,i.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,i.jsx)(R.Z,{size:16})," Secure your View"]}),(0,i.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,i.jsx)("p",{children:"This view is defined with the Security Definer property, giving it permissions of the view's creator (Postgres), rather than the permissions of the querying user."}),(0,i.jsx)("p",{children:"Since this view is in the public schema, it is accessible via your project's APIs."}),(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsx)(K.z,{type:"default",asChild:!0,children:(0,i.jsx)(L(),{target:"_blank",href:"/project/".concat(a,"/advisors/security?preset=").concat(null==eb?void 0:eb.level,"&id=").concat(null==eb?void 0:eb.cache_key),children:"Learn more"})})})]})]})]}),d&&"public"===t.schema&&(0,i.jsxs)(J.J2,{open:j,onOpenChange:()=>w(!j),modal:!1,children:[(0,i.jsx)(J.xo,{asChild:!0,children:(0,i.jsx)(K.z,{type:"warning",icon:(0,i.jsx)(R.Z,{strokeWidth:1.5}),children:"Foreign table is accessible via your project's APIs"})}),(0,i.jsxs)(J.yk,{className:"min-w-[395px] text-sm",align:"end",children:[(0,i.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,i.jsx)(R.Z,{size:16})," Secure Foreign table"]}),(0,i.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,i.jsx)("p",{children:"Foreign tables do not enforce RLS. Move them to a private schema not exposed to Postgrest or disable Postgrest."}),(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsx)(K.z,{type:"default",asChild:!0,children:(0,i.jsx)(L(),{target:"_blank",href:"https://supabase.com/docs/guides/database/extensions/wrappers/overview#security",children:"Learn more"})})})]})]})]}),(0,i.jsx)(B.Q,{serviceRoleLabel:"postgres"}),c&&g&&(0,i.jsxs)(K.z,{type:"default",icon:(0,i.jsx)(_.Z,{strokeWidth:1.5,className:eu?"text-brand":"text-foreground-muted"}),onClick:()=>D(!0),children:["Realtime ",eu?"on":"off"]}),eg&&(0,i.jsx)(I.Z,{section:["entities",t.name]})]}),(0,i.jsx)(Y.Z,{visible:N,loading:ef,title:"".concat(eu?"Disable":"Enable"," realtime for ").concat(t.name),confirmLabel:"".concat(eu?"Disable":"Enable"," realtime"),confirmLabelLoading:"".concat(eu?"Disabling":"Enabling"," realtime"),onCancel:()=>D(!1),onConfirm:()=>ew(),"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"GridHeaderActions.tsx",children:(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("p",{className:"text-sm",children:["Once realtime has been ",eu?"disabled":"enabled",", the table will"," ",eu?"no longer ":"","broadcast any changes to authorized subscribers."]}),!eu&&(0,i.jsxs)("p",{className:"text-sm",children:["You may also select which events to broadcast to subscribers on the"," ",(0,i.jsx)(L(),{href:"/project/".concat(a,"/database/publications"),className:"text-brand",children:"database publications"})," ","settings."]})]})}),(0,i.jsx)(ec,{table:t,isAutofixViewSecurityModalOpen:$,setIsAutofixViewSecurityModalOpen:ee,"data-sentry-element":"ViewEntityAutofixSecurityModal","data-sentry-source-file":"GridHeaderActions.tsx"}),c&&(0,i.jsx)(X.Z,{danger:t.rls_enabled,visible:C,title:"Confirm to enable Row Level Security",description:"Are you sure you want to enable Row Level Security for this table?",buttonLabel:"Enable RLS",buttonLoadingLabel:"Updating",onSelectCancel:eS,onSelectConfirm:eN})]})},em=t(31472),ef=t(13064),eh=t(44735),ep=e=>{let{id:n}=e;return(0,i.jsx)("div",{className:"flex items-center justify-center h-full","data-sentry-component":"NotFoundState","data-sentry-source-file":"NotFoundState.tsx",children:(0,i.jsx)("div",{className:"w-[400px]",children:(0,i.jsx)(ef.Z,{icon:(0,i.jsx)(eh.Z,{strokeWidth:2}),title:"Unable to find your table with ID ".concat(n),"data-sentry-element":"InformationBox","data-sentry-source-file":"NotFoundState.tsx"})})})},eg=t(42533),ex=t(67333),ev=t(85229),ey=t(98809),eb=t(99968),ej=t(63621),ew=t(87882);let eS=e=>{let{id:n}=e;return"\n    ".concat(ew.k,"\n\n    with table_info as (\n      select \n        n.nspname::text as schema,\n        c.relname::text as name\n      from pg_class c\n      join pg_namespace n on n.oid = c.relnamespace\n      where c.oid = ").concat(n,"\n    )\n    select pg_temp.pg_get_tabledef (\n      t.schema,\n      t.name,\n      false,\n      'FKEYS_INTERNAL',\n      'INCLUDE_TRIGGERS'\n    ) as definition\n    from table_info t;\n  ").trim()};async function eN(e,n){let{projectRef:t,connectionString:i,id:o}=e;if(!o)throw Error("id is required");let a=eS({id:o}),{result:r}=await (0,ee.R)({projectRef:t,connectionString:i,sql:a,queryKey:["table-definition",o]},n);return r[0].definition.trim()}let eD=function(e){let{projectRef:n,connectionString:t,id:i}=e,{enabled:o=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,$.a)(en.A.tableDefinition(n,i),e=>{let{signal:o}=e;return eN({projectRef:n,connectionString:t,id:i},o)},{enabled:o&&void 0!==n&&void 0!==i&&!isNaN(i),...a})};var eC=t(37462),eA=t(45536),eE=e=>{let{entity:n}=e,{ref:t}=(0,m.UO)(),o=(0,z.useRef)(null),a=(0,z.useRef)(null),{resolvedTheme:r}=(0,ey.F)(),{project:l}=(0,p.d2)(),s=eo({id:null==n?void 0:n.id,projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString},{enabled:(0,x.D1)(n)}),c=eD({id:null==n?void 0:n.id,projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString},{enabled:(0,x.N3)(n)}),{data:d,isLoading:u}=(0,x.D1)(n)?s:c,f=(0,x.Du)(n)?"create view ".concat(n.schema,".").concat(n.name," as\n"):(0,x.z_)(n)?"create materialized view ".concat(n.schema,".").concat(n.name," as\n"):"",h=(0,z.useMemo)(()=>d?(0,eC._)(f+d):void 0,[d]),g=async(e,n)=>{o.current=e,a.current=n,e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}),await (0,eA.Vs)(500),null==e||e.focus()};return u?(0,i.jsxs)("div",{className:"h-full grid",children:[(0,i.jsx)("div",{className:"p-4",children:(0,i.jsx)(ej.A,{})}),(0,i.jsx)("div",{className:"mt-auto",children:(0,i.jsx)(eb.Z,{})})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"flex-grow overflow-y-auto border-t border-muted relative",children:[(0,i.jsx)(K.z,{asChild:!0,type:"default",className:"absolute top-2 right-5 z-10","data-sentry-element":"Button","data-sentry-source-file":"TableDefinition.tsx",children:(0,i.jsx)(L(),{href:"/project/".concat(t,"/sql/new?content=").concat(encodeURIComponent(null!=h?h:"")),"data-sentry-element":"Link","data-sentry-source-file":"TableDefinition.tsx",children:"Open in SQL Editor"})}),(0,i.jsx)(ev.default,{className:"monaco-editor",theme:(null==r?void 0:r.includes("dark"))?"vs-dark":"vs",onMount:g,defaultLanguage:"pgsql",value:h,path:"",options:{domReadOnly:!0,readOnly:!0,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0},"data-sentry-element":"Editor","data-sentry-source-file":"TableDefinition.tsx"})]}),(0,i.jsx)(eb.Z,{"data-sentry-element":"Footer","data-sentry-source-file":"TableDefinition.tsx"})]})},eR=e=>{var n,t;let{theme:r="dark",isLoadingSelectedTable:s=!1,selectedTable:A}=e,E=(0,d.useRouter)(),{ref:R,id:_}=(0,m.UO)(),{project:k}=(0,p.d2)(),L=(0,C._2)(),z=(0,D.z6)(),[{view:T="data"}]=(0,w.x)(),Z=(0,b.Xo)(o.KA.TENANT_SQL_ADMIN_WRITE,"tables"),I=(0,b.Xo)(o.KA.TENANT_SQL_ADMIN_WRITE,"columns"),F=!Z&&!I,q=(0,a.NL)(),{mutate:M}=(0,y.Gz)({async onMutate(e){let{projectRef:n,table:t,configuration:i,payload:o}=e,a=new Set(Object.keys(i.identifiers)),r=v.s.tableRows(n,{table:{id:t.id}});await q.cancelQueries(r);let l=q.getQueriesData(r);return q.setQueriesData(r,e=>{var n;return{rows:null!==(n=null==e?void 0:e.rows.map(e=>Object.entries(e).filter(e=>{let[n]=e;return a.has(n)}).every(e=>{let[n,t]=e;return t===i.identifiers[n]})?{...e,...o}:e))&&void 0!==n?n:[]}}),{previousRowsQueries:l}},onError(e,n,t){let{previousRowsQueries:i}=t;i.forEach(e=>{let[n,t]=e;t&&q.setQueriesData(n,t),q.invalidateQueries(n)}),K(e)}}),O=(0,j.Z)(null!==(n=null==A?void 0:A.columns)&&void 0!==n?n:N.Z6);if(s)return(0,i.jsx)(em.h,{});if(c()(A))return(0,i.jsx)(ep,{id:Number(_)});let V=(0,x.Du)(A)||(0,x.z_)(A),W=(0,x.N3)(A),U=S.s.includes(null!==(t=null==A?void 0:A.schema)&&void 0!==t?t:""),G=W&&!U,Q=(0,h.NK)(A),P="".concat(A.schema,"_").concat(A.name),K=e=>{var n,t;u.Am.error(null!==(t=null!==(n=null==e?void 0:e.details)&&void 0!==n?n:null==e?void 0:e.message)&&void 0!==t?t:e)};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(f.z,{theme:r,gridProps:{height:"100%"},projectRef:R,editable:!F&&G,schema:A.schema,table:Q,headerActions:(0,i.jsx)(eu,{table:A,canEditViaTableEditor:G}),onAddColumn:L.onAddColumn,onEditColumn:e=>{let n=l()(O.current,{name:e});n?L.onEditColumn(n):u.Am.error("Unable to find column ".concat(e," in ").concat(null==A?void 0:A.name))},onDeleteColumn:e=>{var n;let t=l()(null!==(n=O.current)&&void 0!==n?n:[],{name:e});t?L.onDeleteColumn(t):u.Am.error("Unable to find column ".concat(e," in ").concat(null==A?void 0:A.name))},onAddRow:L.onAddRow,updateTableRow:(e,n)=>{var t;if(!k)return;let o=null===(t=A.columns)||void 0===t?void 0:t.filter(e=>{var n;return(null!==(n=null==e?void 0:e.enums)&&void 0!==n?n:[]).length>0&&"array"===e.data_type.toLowerCase()}).map(e=>e.name),a={};if((0,x.N3)(A)&&A.primary_keys.forEach(n=>{let t=A.columns.find(e=>e.name===n.name);a[n.name]=(null==t?void 0:t.format)==="bytea"?(0,eg.D4)(e[n.name]):e[n.name]}),0===Object.keys(a).length)return(0,u.Am)("Unable to update row as table has no primary keys",{description:(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"Add a primary key column to your table first to serve as a unique identifier for each row before updating or deleting the row."}),(0,i.jsx)("div",{className:"mt-3",children:(0,i.jsx)(g.G,{href:"https://supabase.com/docs/guides/database/tables#primary-keys"})})]})});M({projectRef:k.ref,connectionString:k.connectionString,table:A,configuration:{identifiers:a},payload:n,enumArrayColumns:o,impersonatedRole:z()})},onEditRow:L.onEditRow,onImportData:L.onImportData,onError:K,onExpandJSONEditor:(e,n)=>{L.onExpandJSONEditor({column:e,row:n,value:JSON.stringify(n[e])||""})},onExpandTextEditor:(e,n)=>{L.onExpandTextEditor(e,n)},onEditForeignKeyColumnValue:L.onEditForeignKeyColumnValue,showCustomChildren:(V||W)&&"definition"===T,customHeader:(V||W)&&"definition"===T?(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsxs)("p",{children:["SQL Definition of ",(0,i.jsx)("code",{className:"text-sm",children:A.name})," "]}),(0,i.jsx)("p",{className:"text-foreground-light text-sm",children:"(Read only)"})]}):null,"data-sentry-element":"SupabaseGrid","data-sentry-source-file":"TableGridEditor.tsx",children:(V||W)&&(0,i.jsx)(eE,{entity:A})},P),(0,i.jsx)(ex.Z,{editable:!F&&G,selectedTable:(0,x.N3)(A)?A:void 0,onTableCreated:e=>{E.push("/project/".concat(R,"/editor/").concat(e.id))},"data-sentry-element":"SidePanelEditor","data-sentry-source-file":"TableGridEditor.tsx"})]})};t(46908)},92259:function(e,n,t){t.d(n,{r:function(){return c}});var i=t(28894),o=t(6464),a=t(62432),r=t(37756),l=t(98775);async function s(e,n,t){let{projectRef:i,connectionString:a,schema:r}=e;if(!i)throw Error("projectRef is required");let l=new Headers(t);a&&l.set("x-connection-encrypted",a);let{data:s,error:c}=await (0,o.U2)("/platform/pg-meta/{ref}/policies",{params:{header:{"x-connection-encrypted":a},path:{ref:i},query:{included_schemas:r||"",excluded_schemas:""}},headers:l,signal:n});return c&&(0,o.S3)(c),s}let c=function(e){let{projectRef:n,connectionString:t,schema:o}=e,{enabled:c=!0,...d}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=(0,a.Vm)(),m=(null==u?void 0:u.status)===r.S.ACTIVE_HEALTHY;return(0,i.a)(l.R.list(n,o),e=>{let{signal:i}=e;return s({projectRef:n,connectionString:t,schema:o},i)},{enabled:c&&void 0!==n&&m,...d})}},50936:function(e,n,t){t.d(n,{Z:function(){return F}});var i=t(97458),o=t(4839),a=t(83145),r=t.n(a),l=t(34549),s=t(27850),c=t(88971),d=t(62423),u=t(36457),m=t(64618),f=t(65051),h=t(25878),p=t(99492),g=t(24561),x=t(79790),v=t(62175);async function y(e){let{projectRef:n,connectionString:t,table:i,filters:o,impersonatedRole:a}=e,r=(0,p.Jh)(function(e){var n;let{table:t,filters:i}=e,o=new f.A().from(t.name,null!==(n=t.schema)&&void 0!==n?n:void 0).delete();return i.filter(e=>e.value&&""!==e.value).forEach(e=>{let n=(0,v.q)(t,e);o=o.filter(e.column,e.operator,n)}),o.toSql()}({table:i,filters:o}),{projectRef:n,role:a}),{result:l}=await (0,h.R)({projectRef:n,connectionString:t,sql:r,isRoleImpersonationEnabled:(0,g.Gm)(a)});return l}let b=function(){let{onSuccess:e,onError:n,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,u.NL)();return(0,m.D)(e=>y(e),{async onSuccess(n,t,o){let{projectRef:a,table:r}=t;await i.invalidateQueries(x.s.tableRowsAndCount(a,r.id)),await (null==e?void 0:e(n,t,o))},async onError(e,t,i){void 0===n?l.Am.error("Failed to delete all table rows: ".concat(e.message)):n(e,t,i)},...t})};var j=t(49996),w=t(67096);async function S(e){let{projectRef:n,connectionString:t,table:i,rows:o,impersonatedRole:a}=e,r=(0,p.Jh)(function(e){var n;let{table:t,rows:i}=e,{primaryKeys:o,error:a}=(0,v.h)({table:t});if(a)throw a;let r=new f.A().from(t.name,null!==(n=t.schema)&&void 0!==n?n:void 0).delete();return null==o||o.forEach(e=>{let n=i.map(n=>n[e]);r=r.filter(e,"in",n)}),r.toSql()}({table:i,rows:o}),{projectRef:n,role:a}),{result:l}=await (0,h.R)({projectRef:n,connectionString:t,sql:r,isRoleImpersonationEnabled:(0,g.Gm)(a)});return l}let N=function(){let{onSuccess:e,onError:n,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=(0,u.NL)();return(0,m.D)(e=>S(e),{async onSuccess(n,t,i){let{projectRef:a,table:r}=t;await o.invalidateQueries(x.s.tableRowsAndCount(a,r.id)),await (null==e?void 0:e(n,t,i))},async onError(e,t,o){if(void 0===n){let{table:n,rows:o}=t,a=e.message.includes("Please add a primary key column"),r=e.message.includes("violates foreign key constraint"),s=o.length>1;if(r){let t=n.name,o=e.message.split("on table ")[2].replaceAll('"',""),a=e.message.split("foreign key constraint")[1].split("on table")[0].replaceAll('"',""),r=s?"Unable to delete rows as one of them is currently referenced by a foreign key constraint from the table `".concat(o,"`."):"Unable to delete row as it is currently referenced by a foreign key constraint from the table `".concat(o,"`."),c="Set an on delete behavior on the foreign key relation `".concat(a,"` in the `").concat(o,"` table to automatically respond when row(s) are being deleted in the `").concat(t,"` table.");(0,l.Am)(r,{description:(0,i.jsx)(j.U,{content:c,className:"[&>p]:m-0"}),action:(0,i.jsx)("div",{className:"w-full flex gap-x-2 !mx-0 mt-3",children:(0,i.jsx)(w.G,{href:"https://supabase.com/docs/guides/database/postgres/cascade-deletes"})})})}else a?(0,l.Am)("Unable to delete row(s) as table has no primary keys",{description:(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"Add a primary key column to your table first to serve as a unique identifier for each row before updating or deleting the row."}),(0,i.jsx)("div",{className:"mt-3",children:(0,i.jsx)(w.G,{href:"https://supabase.com/docs/guides/database/tables#primary-keys"})})]})}):l.Am.error("Failed to delete table row: ".concat(e.message))}else n(e,t,o)},...t})};async function D(e){let{projectRef:n,connectionString:t,table:i}=e,o=function(e){var n;let{table:t}=e;return new f.A().from(t.name,null!==(n=t.schema)&&void 0!==n?n:void 0).truncate().toSql()}({table:i}),{result:a}=await (0,h.R)({projectRef:n,connectionString:t,sql:o});return a}let C=function(){let{onSuccess:e,onError:n,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,u.NL)();return(0,m.D)(e=>D(e),{async onSuccess(n,t,o){let{projectRef:a,table:r}=t;await i.invalidateQueries(x.s.tableRowsAndCount(a,r.id)),await (null==e?void 0:e(n,t,o))},async onError(e,t,i){void 0===n?l.Am.error("Failed to truncate table row: ".concat(e.message)):n(e,t,i)},...t})};var A=t(73167),E=t(79581),R=t(17319),_=t(53114),k=t(56844),L=t(96226),z=t(10046),T=t(10947),Z=t(90839),I=t(32002),F=e=>{var n,t,a,u,m,f,h,p,x;let{selectedTable:v,onAfterDeleteTable:y=k.ZT}=e,{project:j}=(0,c.d2)(),w=(0,L._2)(),{selectedSchema:S}=(0,R.B)(),[{filter:D},F]=(0,_.x)({arrayKeys:["filter","sort"]}),q=(0,s.Yb)(D),M=(0,E.AF)({projectRef:null==j?void 0:j.ref,connectionString:null==j?void 0:j.connectionString}),O=e=>{F(n=>{var t,i;let o=null!==(t=null==n?void 0:n.filter)&&void 0!==t?t:[],a=null!==(i=null==n?void 0:n.sort)&&void 0!==i?i:[];return{...n,filter:o.filter(n=>{let[t]=n.split(":");if(t!==e)return n}),sort:a.filter(n=>{let[t]=n.split(":");if(t!==e)return n})}})},{mutate:V}=(0,d.v)({onSuccess:()=>{var e;if((null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)!=="column")return;let n=w.confirmationDialog.column;O(n.name),l.Am.success('Successfully deleted column "'.concat(n.name,'"'))},onError:e=>{var n;if((null===(n=w.confirmationDialog)||void 0===n?void 0:n.type)!=="column")return;let t=w.confirmationDialog.column;l.Am.error("Failed to delete ".concat(t.name,": ").concat(e.message))},onSettled:()=>{w.closeConfirmationDialog()}}),{mutate:W}=(0,A.H)({onSuccess:async()=>{y(await M(S)),l.Am.success('Successfully deleted table "'.concat(null==v?void 0:v.name,'"'))},onError:e=>{l.Am.error("Failed to delete ".concat(null==v?void 0:v.name,": ").concat(e.message))},onSettled:()=>{w.closeConfirmationDialog()}}),{mutate:U}=N({onSuccess:()=>{var e,n,t;(null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)==="row"&&(null===(n=(t=w.confirmationDialog).callback)||void 0===n||n.call(t)),l.Am.success("Successfully deleted selected row(s)")},onSettled:()=>{w.closeConfirmationDialog()}}),{mutate:G}=b({onSuccess:()=>{var e,n,t;(null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)==="row"&&(null===(n=(t=w.confirmationDialog).callback)||void 0===n||n.call(t)),l.Am.success("Successfully deleted selected rows")},onError:e=>{l.Am.error("Failed to delete rows: ".concat(e.message))},onSettled:()=>{w.closeConfirmationDialog()}}),{mutate:Q}=C({onSuccess:()=>{var e,n,t;(null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)==="row"&&(null===(n=(t=w.confirmationDialog).callback)||void 0===n||n.call(t)),l.Am.success("Successfully deleted all rows from table")},onError:e=>{l.Am.error("Failed to delete rows: ".concat(e.message))},onSettled:()=>{w.closeConfirmationDialog()}}),P=(null===(n=w.confirmationDialog)||void 0===n?void 0:n.type)==="row"&&w.confirmationDialog.allRowsSelected,K=(null===(t=w.confirmationDialog)||void 0===t?void 0:t.type)==="row"?w.confirmationDialog.allRowsSelected?null!==(x=w.confirmationDialog.numRows)&&void 0!==x?x:0:w.confirmationDialog.rows.length:0,H=((null===(a=w.confirmationDialog)||void 0===a?void 0:a.type)==="column"||(null===(u=w.confirmationDialog)||void 0===u?void 0:u.type)==="table")&&w.confirmationDialog.isDeleteWithCascade,J=async()=>{var e;if((null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)!=="column"||void 0===j)return;let n=w.confirmationDialog.column;void 0!==n&&V({id:n.id,cascade:H,projectRef:j.ref,connectionString:null==j?void 0:j.connectionString,table:v})},X=async()=>{var e;(null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)==="table"&&void 0!==v&&W({projectRef:null==j?void 0:j.ref,connectionString:null==j?void 0:j.connectionString,schema:v.schema,id:v.id,cascade:H})},Y=(0,g.z6)(),B=async()=>{var e;if(!j)return console.error("Project ref is required");if(!v)return console.error("Selected table required");if((null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)!=="row")return;let n=w.confirmationDialog.rows;if(w.confirmationDialog.allRowsSelected){if(0===q.length){if(void 0!==Y())return w.closeConfirmationDialog(),l.Am.error("Table truncation is not supported when impersonating a role");Q({projectRef:j.ref,connectionString:j.connectionString,table:v})}else G({projectRef:j.ref,connectionString:j.connectionString,table:v,filters:q,impersonatedRole:Y()})}else U({projectRef:j.ref,connectionString:j.connectionString,table:v,rows:n,impersonatedRole:Y()})};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(I.Z,{variant:"destructive",size:"small",visible:(null===(m=w.confirmationDialog)||void 0===m?void 0:m.type)==="column",title:'Confirm deletion of column "'.concat((null===(f=w.confirmationDialog)||void 0===f?void 0:f.type)==="column"&&w.confirmationDialog.column.name,'"'),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>{w.closeConfirmationDialog()},onConfirm:J,"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"DeleteConfirmationDialogs.tsx",children:(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to delete the selected column? This action cannot be undone."}),(0,i.jsx)(z.Z,{label:"Drop column with cascade?",description:"Deletes the column and its dependent objects",checked:H,onChange:()=>w.toggleConfirmationIsWithCascade(),"data-sentry-element":"Checkbox","data-sentry-source-file":"DeleteConfirmationDialogs.tsx"}),H&&(0,i.jsxs)(T.bZ,{variant:"warning",title:"Warning: Dropping with cascade may result in unintended consequences",children:[(0,i.jsx)(T.Cd,{children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,i.jsx)(T.X,{children:(0,i.jsx)(Z.z,{asChild:!0,size:"tiny",type:"default",icon:(0,i.jsx)(o.Z,{}),children:(0,i.jsx)(r(),{href:"https://www.postgresql.org/docs/current/ddl-depend.html",target:"_blank",rel:"noreferrer",children:"About dependency tracking"})})})]})]})}),(0,i.jsx)(I.Z,{variant:"destructive",size:"small",visible:(null===(h=w.confirmationDialog)||void 0===h?void 0:h.type)==="table",title:(0,i.jsx)("span",{className:"break-words",children:'Confirm deletion of table "'.concat(null==v?void 0:v.name,'"')}),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>{w.closeConfirmationDialog()},onConfirm:X,"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"DeleteConfirmationDialogs.tsx",children:(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to delete the selected table? This action cannot be undone."}),(0,i.jsx)(z.Z,{label:"Drop table with cascade?",description:"Deletes the table and its dependent objects",checked:H,onChange:()=>w.toggleConfirmationIsWithCascade(!H),"data-sentry-element":"Checkbox","data-sentry-source-file":"DeleteConfirmationDialogs.tsx"}),H&&(0,i.jsxs)(T.bZ,{variant:"warning",children:[(0,i.jsx)(T.Cd,{children:"Warning: Dropping with cascade may result in unintended consequences"}),(0,i.jsx)(T.X,{children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,i.jsx)(T.X,{className:"mt-4",children:(0,i.jsx)(Z.z,{asChild:!0,size:"tiny",type:"default",icon:(0,i.jsx)(o.Z,{}),children:(0,i.jsx)(r(),{href:"https://www.postgresql.org/docs/current/ddl-depend.html",target:"_blank",rel:"noreferrer",children:"About dependency tracking"})})})]})]})}),(0,i.jsx)(I.Z,{variant:"destructive",size:"small",visible:(null===(p=w.confirmationDialog)||void 0===p?void 0:p.type)==="row",title:(0,i.jsxs)("p",{className:"break-words",children:[(0,i.jsx)("span",{children:"Confirm to delete the selected row"}),(0,i.jsx)("span",{children:K>1&&"s"})]}),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>w.closeConfirmationDialog(),onConfirm:()=>B(),"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"DeleteConfirmationDialogs.tsx",children:(0,i.jsx)("div",{className:"space-y-4",children:(0,i.jsxs)("p",{className:"text-sm text-foreground-light",children:[(0,i.jsx)("span",{children:"Are you sure you want to delete "}),(0,i.jsxs)("span",{children:[P?"all":"the selected"," "]}),(0,i.jsx)("span",{children:K>1&&"".concat(K," ")}),(0,i.jsx)("span",{children:"row"}),(0,i.jsx)("span",{children:K>1&&"s"}),(0,i.jsx)("span",{children:"? This action cannot be undone."})]})})})]})}},32472:function(e,n,t){var i=t(97458),o=t(52983),a=t(42155),r=t(19540),l=t(90839);n.Z=e=>{let{visible:n=!1,danger:t=!1,title:s="",description:c="",size:d="small",buttonLabel:u="",buttonLoadingLabel:m="",onSelectCancel:f=()=>{},onSelectConfirm:h=()=>{}}=e;(0,o.useEffect)(()=>{n&&g(!1)},[n]);let[p,g]=(0,o.useState)(!1),x=()=>{g(!0),h()};return(0,i.jsx)(a.Z,{header:s,visible:n,title:s,description:c,size:d,hideFooter:!0,onCancel:f,"data-sentry-element":"Modal","data-sentry-component":"ConfirmModal","data-sentry-source-file":"ConfirmDialog.tsx",children:(0,i.jsx)(r.Z,{initialValues:{},validateOnBlur:!0,onSubmit:()=>x(),validate:()=>[],"data-sentry-element":"Form","data-sentry-source-file":"ConfirmDialog.tsx",children:()=>(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(a.Z.Content,{children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(l.z,{block:!0,htmlType:"button",type:"default",onClick:f,disabled:p,children:"Cancel"}),(0,i.jsx)(l.z,{htmlType:"submit",block:!0,type:t?"danger":"primary",disabled:p,loading:p,children:m&&p?m:u||"Confirm"})]})})})})})}}}]);